<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
<head> 
    <title>PaySwarm 1.0 - Web API</title> 
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
    
<!--  
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
      -->
 
     
     
    
    
    
  <style type="text/css">
/*****************************************************************
 * ReSpec CSS
 * Robin Berjon (robin at berjon dot com)
 * v0.05 - 2009-07-31
 *****************************************************************/


/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

code {
    color:  #ff4500;
}


/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID {
    font-weight:    bold;
    color:  #005a9c;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.attributes dd, .methods dd, .constants dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}

/* --- TOC --- */
.toc a {
    text-decoration:    none;
}

a .secno {
    color:  #000;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

/* --- EXAMPLES --- */
pre.example {
    border-top: 1px solid #ff4500;
    border-bottom: 1px solid #ff4500;
    padding:    1em;
    margin-top: 1em;
}

pre.example::before {
    content:    "Example";
    display:    block;
    width:      150px;
    background: #ff4500;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

/* --- EDITORIAL NOTES --- */
.issue {
    padding:    1em;
    margin: 1em 0em 0em;
    border: 1px solid #f00;
    background: #ffc;
}

.issue::before {
    content:    "Issue";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #f00;
    background: #fff;
    padding:    3px 1em;
}

.note {
    margin: 1em 0em 0em;
    padding:    1em;
    border: 2px solid #cff6d9;
    background: #e2fff0;
}

.note::before {
    content:    "Note";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #cff6d9;
    background: #fff;
    padding:    3px 1em;
}

/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
}

span.practicelab   { background: #dfffff; }

span.practicelab {
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}

/* --- SYNTAX HIGHLIGHTING --- */
pre.sh_sourceCode {
  background-color: white;
  color: black;
  font-style: normal;
  font-weight: normal;
}

pre.sh_sourceCode .sh_keyword { color: #005a9c; font-weight: bold; }           /* language keywords */
pre.sh_sourceCode .sh_type { color: #666; }                            /* basic types */
pre.sh_sourceCode .sh_usertype { color: teal; }                             /* user defined types */
pre.sh_sourceCode .sh_string { color: red; font-family: monospace; }        /* strings and chars */
pre.sh_sourceCode .sh_regexp { color: orange; font-family: monospace; }     /* regular expressions */
pre.sh_sourceCode .sh_specialchar { color: 	#ffc0cb; font-family: monospace; }  /* e.g., \n, \t, \\ */
pre.sh_sourceCode .sh_comment { color: #A52A2A; font-style: italic; }         /* comments */
pre.sh_sourceCode .sh_number { color: purple; }                             /* literal numbers */
pre.sh_sourceCode .sh_preproc { color: #00008B; font-weight: bold; }       /* e.g., #include, import */
pre.sh_sourceCode .sh_symbol { color: blue; }                            /* e.g., *, + */
pre.sh_sourceCode .sh_function { color: black; font-weight: bold; }         /* function calls and declarations */
pre.sh_sourceCode .sh_cbracket { color: red; }                              /* block brackets (e.g., {, }) */
pre.sh_sourceCode .sh_todo { font-weight: bold; background-color: #00FFFF; }   /* TODO and FIXME */

/* Predefined variables and functions (for instance glsl) */
pre.sh_sourceCode .sh_predef_var { color: #00008B; }
pre.sh_sourceCode .sh_predef_func { color: #00008B; font-weight: bold; }

/* for OOP */
pre.sh_sourceCode .sh_classname { color: teal; }

/* line numbers (not yet implemented) */
pre.sh_sourceCode .sh_linenum { display: none; }

/* Internet related */
pre.sh_sourceCode .sh_url { color: blue; text-decoration: underline; font-family: monospace; }

/* for ChangeLog and Log files */
pre.sh_sourceCode .sh_date { color: blue; font-weight: bold; }
pre.sh_sourceCode .sh_time, pre.sh_sourceCode .sh_file { color: #00008B; font-weight: bold; }
pre.sh_sourceCode .sh_ip, pre.sh_sourceCode .sh_name { color: #006400; }

/* for Prolog, Perl... */
pre.sh_sourceCode .sh_variable { color: #006400; }

/* for LaTeX */
pre.sh_sourceCode .sh_italics { color: #006400; font-style: italic; }
pre.sh_sourceCode .sh_bold { color: #006400; font-weight: bold; }
pre.sh_sourceCode .sh_underline { color: #006400; text-decoration: underline; }
pre.sh_sourceCode .sh_fixed { color: green; font-family: monospace; }
pre.sh_sourceCode .sh_argument { color: #006400; }
pre.sh_sourceCode .sh_optionalargument { color: purple; }
pre.sh_sourceCode .sh_math { color: orange; }
pre.sh_sourceCode .sh_bibtex { color: blue; }

/* for diffs */
pre.sh_sourceCode .sh_oldfile { color: orange; }
pre.sh_sourceCode .sh_newfile { color: #006400; }
pre.sh_sourceCode .sh_difflines { color: blue; }

/* for css */
pre.sh_sourceCode .sh_selector { color: purple; }
pre.sh_sourceCode .sh_property { color: blue; }
pre.sh_sourceCode .sh_value { color: #006400; font-style: italic; }

/* other */
pre.sh_sourceCode .sh_section { color: black; font-weight: bold; }
pre.sh_sourceCode .sh_paren { color: red; }
pre.sh_sourceCode .sh_attribute { color: #006400; }

</style><style type="text/css">ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }

</style><style type="text/css">/*
 * Derived from einaros's Sons of Obsidian theme at
 * http://studiostyl.es/schemes/son-of-obsidian by
 * and Alex Ford of CodeTunnel
 * http://CodeTunnel.com/blog/post/71/google-code-prettify-obsidian-theme
 */

.str
{
    color: #93C763;
}
.kwd
{
    color: #EC7600;
}
.com
{
    color: #66747B;
}
.typ
{
    color: #678CB1;
}
.lit
{
    color: #FACD22;
}
.pun
{
    color: #F1F2F3;
}
.pln
{
    color: #F1F2F3;
}
.tag
{
    color: #8AC763;
}
.tag.jsonld-uri
{
    color: #8A93CD;
}
.tag.turtle-uri
{
    color: #8A93CD;
}
.tag.turtle-curie
{
    color: #AC84CB;
}
.atn
{
    color: #E0E2E4;
}
.atn.jsonld-curie
{
    color: #AC84CB;
}
.atn.turtle-curie
{
    color: #FACD22;
}
.atv
{
    color: #EC7600;
}
.dec
{
    color: purple;
}
pre.prettyprint
{
    border: 0px solid #888;
}
ol.linenums
{
    margin-top: 0;
    margin-bottom: 0;
}

.prettyprint {
    font: monospace;
    /*font-size: 0.8em;*/
    font-weight: bold;
    background: #000;
    color: #ddd;
    /*overflow: auto;*/
}
li.L0, li.L1, li.L2, li.L3, li.L4, li.L5, li.L6, li.L7, li.L8, li.L9
{
    color: #555;
}
li.L1, li.L3, li.L5, li.L7, li.L9 {
    background: #111;
}
@media print
{
    .str
    {
        color: #060;
    }
    .kwd
    {
        color: #006;
        font-weight: bold;
    }
    .com
    {
        color: #600;
        font-style: italic;
    }
    .typ
    {
        color: #404;
        font-weight: bold;
    }
    .lit
    {
        color: #044;
    }
    .pun
    {
        color: #440;
    }
    .pln
    {
        color: #000;
    }
    .tag
    {
        color: #006;
        font-weight: bold;
    }
    .atn
    {
        color: #404;
    }
    .atv
    {
        color: #060;
    }
}
</style><link href="//www.w3.org/StyleSheets/TR/w3c-unofficial" rel="stylesheet" type="text/css" charset="utf-8" /></head> 
  <body style="display: inherit; "><div class="head"><p></p><h1 class="title" id="title">PaySwarm 1.0 - Web API</h1><h2 id="unofficial-draft-16-january-2012">Unofficial Draft 16 January 2012</h2><dl><dt>Editor:</dt><dd><a href="http://digitalbazaar.com/">Manu Sporny</a>, <a href="http://digitalbazaar.com/">Digital Bazaar, Inc.</a></dd>
</dl><p>This document is also available in this non-normative format: <a href="diff-20111214.html">diff to previous version</a>.</p><p class="copyright">Copyright 2009-2011 © Digital Bazaar, Inc.</p><hr /></div> 
    <div id="abstract" class="introductory section"><h2>Abstract</h2> 
      <p>
The PaySwarm Web platform is an open web standard that enables Web browsers and 
Web devices to perform Universal Web Payment. PaySwarm enables the people that 
create digital content such as blog posts, music, film, episodic content, 
photos, virtual goods, and documents to distribute their creations through 
their website and receive payment directly from their fans and customers. The 
technology is designed to be integrated directly into blogging platforms, 
content management systems and general purpose websites. The standard can
be applied to the entire content distribution lifecycle, from asset description, 
to product listings, to licenses, contracts and financial transactions. 
Features include the ability to exchange money, transact individual sales, 
subscriptions and micropayments.
      </p> 
    </div><div id="sotd" class="introductory section"><h2>Status of This Document</h2><p>This document is merely a public working draft of a potential specification. It has no official standing of any kind and does not represent the support or consensus of any standards organisation.</p></div><div id="toc" class="section"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a></li><li class="tocline"><a href="#the-conceptual-model" class="tocxref"><span class="secno">2. </span>The Conceptual Model</a><ul class="toc"><li class="tocline"><a href="#identity-and-identifiers" class="tocxref"><span class="secno">2.1 </span>Identity and Identifiers</a></li><li class="tocline"><a href="#participants" class="tocxref"><span class="secno">2.2 </span>Participants</a><ul class="toc"><li class="tocline"><a href="#agent" class="tocxref"><span class="secno">2.2.1 </span>Agent</a></li><li class="tocline"><a href="#participants-1" class="tocxref"><span class="secno">2.2.2 </span>Participants</a></li><li class="tocline"><a href="#vendors" class="tocxref"><span class="secno">2.2.3 </span>Vendors</a></li><li class="tocline"><a href="#payswarm-authorities" class="tocxref"><span class="secno">2.2.4 </span>PaySwarm Authorities</a></li></ul></li><li class="tocline"><a href="#commerce-model" class="tocxref"><span class="secno">2.3 </span>Commerce Model</a><ul class="toc"><li class="tocline"><a href="#transactions" class="tocxref"><span class="secno">2.3.1 </span>Transactions</a></li><li class="tocline"><a href="#assets" class="tocxref"><span class="secno">2.3.2 </span>Assets</a></li><li class="tocline"><a href="#licenses" class="tocxref"><span class="secno">2.3.3 </span>Licenses</a></li><li class="tocline"><a href="#listings" class="tocxref"><span class="secno">2.3.4 </span>Listings</a></li><li class="tocline"><a href="#contracts" class="tocxref"><span class="secno">2.3.5 </span>Contracts</a></li></ul></li></ul></li><li class="tocline"><a href="#base-technologies" class="tocxref"><span class="secno">3. </span>Base Technologies</a><ul class="toc"><li class="tocline"><a href="#representational-state-transfer" class="tocxref"><span class="secno">3.1 </span>Representational State Transfer</a></li><li class="tocline"><a href="#javascript-object-notation-for-linking-data" class="tocxref"><span class="secno">3.2 </span>JavaScript Object Notation for Linking Data</a></li><li class="tocline"><a href="#the-advanced-encryption-standard" class="tocxref"><span class="secno">3.3 </span>The Advanced Encryption Standard</a></li><li class="tocline"><a href="#html-rdfa" class="tocxref"><span class="secno">3.4 </span>HTML+RDFa</a></li></ul></li><li class="tocline"><a href="#communication" class="tocxref"><span class="secno">4. </span>Communication</a><ul class="toc"><li class="tocline"><a href="#requests-and-responses" class="tocxref"><span class="secno">4.1 </span>Requests and Responses</a></li><li class="tocline"><a href="#communication-terms" class="tocxref"><span class="secno">4.2 </span>Communication Terms</a></li><li class="tocline"><a href="#request-signature-algorithm" class="tocxref"><span class="secno">4.3 </span>Request Signature Algorithm</a></li><li class="tocline"><a href="#request-signature-verification-algorithm" class="tocxref"><span class="secno">4.4 </span>Request Signature Verification Algorithm</a></li><li class="tocline"><a href="#response-encryption-algorithm" class="tocxref"><span class="secno">4.5 </span>Response Encryption Algorithm</a></li><li class="tocline"><a href="#response-decryption-algorithm" class="tocxref"><span class="secno">4.6 </span>Response Decryption Algorithm</a></li><li class="tocline"><a href="#security-considerations" class="tocxref"><span class="secno">4.7 </span>Security Considerations</a><ul class="toc"><li class="tocline"><a href="#the-response-token" class="tocxref"><span class="secno">4.7.1 </span>The Response Token</a></li></ul></li></ul></li><li class="tocline"><a href="#the-registration-process" class="tocxref"><span class="secno">5. </span>The Registration Process</a><ul class="toc"><li class="tocline"><a href="#registration-terms" class="tocxref"><span class="secno">5.1 </span>Registration Terms</a></li><li class="tocline"><a href="#buyer-registration" class="tocxref"><span class="secno">5.2 </span>Buyer Registration</a></li><li class="tocline"><a href="#vendor-registration" class="tocxref"><span class="secno">5.3 </span>Vendor Registration</a></li><li class="tocline"><a href="#security-concerns-for-registration" class="tocxref"><span class="secno">5.4 </span>Security Concerns for Registration</a></li></ul></li><li class="tocline"><a href="#the-transaction-process" class="tocxref"><span class="secno">6. </span>The Transaction Process</a><ul class="toc"><li class="tocline"><a href="#transaction-terms" class="tocxref"><span class="secno">6.1 </span>Transaction Terms</a></li><li class="tocline"><a href="#the-transaction-algorithm" class="tocxref"><span class="secno">6.2 </span>The Transaction Algorithm</a></li></ul></li><li class="tocline"><a href="#the-purchase-process" class="tocxref"><span class="secno">7. </span>The Purchase Process</a><ul class="toc"><li class="tocline"><a href="#publishing-an-asset" class="tocxref"><span class="secno">7.1 </span>Publishing an Asset</a></li><li class="tocline"><a href="#publishing-a-license" class="tocxref"><span class="secno">7.2 </span>Publishing a License</a></li><li class="tocline"><a href="#publishing-a-listing" class="tocxref"><span class="secno">7.3 </span>Publishing a Listing</a></li><li class="tocline"><a href="#performing-a-purchase" class="tocxref"><span class="secno">7.4 </span>Performing a Purchase</a><ul class="toc"><li class="tocline"><a href="#purchase-terms" class="tocxref"><span class="secno">7.4.1 </span>Purchase Terms</a></li><li class="tocline"><a href="#the-purchase-algorithm" class="tocxref"><span class="secno">7.4.2 </span>The Purchase Algorithm</a></li></ul></li><li class="tocline"><a href="#performing-automatic-purchases" class="tocxref"><span class="secno">7.5 </span>Performing Automatic Purchases</a><ul class="toc"><li class="tocline"><a href="#purchase-terms-1" class="tocxref"><span class="secno">7.5.1 </span>Purchase Terms</a></li><li class="tocline"><a href="#the-automatic-purchase-algorithm" class="tocxref"><span class="secno">7.5.2 </span>The Automatic Purchase Algorithm</a></li></ul></li><li class="tocline"><a href="#the-contract" class="tocxref"><span class="secno">7.6 </span>The Contract</a></li><li class="tocline"><a href="#verifying-a-purchase" class="tocxref"><span class="secno">7.7 </span>Verifying a Purchase</a></li></ul></li><li class="tocline"><a href="#the-decentralized-settlement-process" class="tocxref"><span class="secno">8. </span>The Decentralized Settlement Process</a><ul class="toc"><li class="tocline"><a href="#decentralized-settlement-terms" class="tocxref"><span class="secno">8.1 </span>Decentralized Settlement Terms</a></li><li class="tocline"><a href="#the-decentralized-settlement-algorithm" class="tocxref"><span class="secno">8.2 </span>The Decentralized Settlement Algorithm</a></li></ul></li><li class="tocline"><a href="#data-portability" class="tocxref"><span class="secno">9. </span>Data Portability</a><ul class="toc"><li class="tocline"><a href="#authority-migration" class="tocxref"><span class="secno">9.1 </span>Authority Migration</a></li><li class="tocline"><a href="#authority-migration-terms" class="tocxref"><span class="secno">9.2 </span>Authority Migration Terms</a></li><li class="tocline"><a href="#the-authority-migration-algorithm" class="tocxref"><span class="secno">9.3 </span>The Authority Migration Algorithm</a></li></ul></li><li class="tocline"><a href="#the-transaction-intent-process" class="tocxref"><span class="secno">10. </span>The Transaction Intent Process</a><ul class="toc"><li class="tocline"><a href="#transaction-intent-terms" class="tocxref"><span class="secno">10.1 </span>Transaction Intent Terms</a></li><li class="tocline"><a href="#the-transaction-intent-algorithm" class="tocxref"><span class="secno">10.2 </span>The Transaction Intent Algorithm</a></li></ul></li><li class="tocline"><a href="#the-payswarm-api" class="tocxref"><span class="secno">11. </span>The PaySwarm API</a></li><li class="tocline"><a href="#implementation-details" class="tocxref"><span class="secno">12. </span>Implementation Details</a><ul class="toc"><li class="tocline"><a href="#digital-signatures" class="tocxref"><span class="secno">12.1 </span>Digital Signatures</a><ul class="toc"><li class="tocline"><a href="#signing" class="tocxref"><span class="secno">12.1.1 </span>Signing</a></li><li class="tocline"><a href="#verifying" class="tocxref"><span class="secno">12.1.2 </span>Verifying</a></li></ul></li></ul></li><li class="tocline"><a href="#security-concerns" class="tocxref"><span class="secno">13. </span>Security Concerns</a><ul class="toc"><li class="tocline"><a href="#identity-management" class="tocxref"><span class="secno">13.1 </span>Identity Management</a></li><li class="tocline"><a href="#digital-signatures-1" class="tocxref"><span class="secno">13.2 </span>Digital Signatures</a></li><li class="tocline"><a href="#identifying-and-removing-troublemakers" class="tocxref"><span class="secno">13.3 </span>Identifying and Removing Troublemakers</a></li><li class="tocline"><a href="#halting-asset-distribution" class="tocxref"><span class="secno">13.4 </span>Halting Asset Distribution</a></li></ul></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">A. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">A.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">A.2 </span>Informative references</a></li></ul></li></ul></div> 

    <div id="introduction" class="section">
      
<!-- OddPage -->
<h2><span class="secno">1. </span>Introduction</h2>
      <p>
The PaySwarm Web platform is an open web standard that enables Web browsers and 
Web devices to perform Universal Web Payment. PaySwarm enables the people that 
create digital content such as blog posts, music, film, episodic content, 
photos, virtual goods, and documents to distribute their creations through 
their website and receive payment directly from their fans and customers. The 
technology is designed to be integrated directly into blogging platforms, 
content management systems and general purpose websites.
      </p>
      <p>
The technology is provided as an open web platform, which is a combination of 
technology that is patent-free, royalty-free, published in a free 
specification, using well-defined protocols and other open technologies. The 
entire PaySwarm standard, like HTML, HTTP, and JavaScript, is an open web 
platform. Almost every successful Web technology is built and released in 
this way.
      </p>      
      <p>
PaySwarm supports Micropayments. The standard assumes that customers do not
want to be bothered to reach for their wallet every time they need to spend a 
couple of cents, or even a couple of dollars. Micropayment in this case, 
specifically refers to the ability to automatically distribute payments in 
increments of up to 1/100,000th of a cent to anybody listed in PaySwarm 
digital contracts.
      </p>
      <p>
It is the goal of this specification to create an environment that is friendly
to content creators and customers alike. Distribution of digital goods is
becoming an increasing part of the Web and therefore compensation for these
digital goods must be as easy to perform as downloading the digital goods. The
PaySwarm specification works with the architecture of the Web to deliver a
solution that is universal across websites, industries and countries.
      </p>
    </div>

    <div id="the-conceptual-model" class="section">
      
<!-- OddPage -->
<h2><span class="secno">2. </span>The Conceptual Model</h2>
      <p>
There are three primary participants in a PaySwarm transaction; the 
buyer, the vendor, and the authority.
      </p>
      <div id="identity-and-identifiers" class="section">
        <h3><span class="secno">2.1 </span>Identity and Identifiers</h3>
        <p>
In order for a universal payment system to work seamlessly, there must be a
universal way of identifying <em>things</em> in the environment. This 
specification uses Internationalized Resource Identifiers [<cite><a class="bibref" rel="biblioentry" href="#bib-IRI">IRI</a></cite>] to 
refer to <em>things</em> on the network. These things can be a personal identity 
(<code>https://example.com/people/bob</code>), 
financial account information 
(<code>https://example.com/people/bob/accounts/42</code>), public cryptography
keys (<code>https://example.com/people/bob/keys/14</code>), assets, licenses 
and a variety of other pieces of long-lived information that exists on the Web. 
By naming these things with long-lived unique identifiers, it becomes possible 
to create a decentralized but stable universal payment architecture.
        </p>
      </div>
      <div id="participants" class="section">
        <h3><span class="secno">2.2 </span>Participants</h3>
        <div id="agent" class="section">
          <h4><span class="secno">2.2.1 </span>Agent</h4>
          <p>
An <dfn title="agent" id="dfn-agent">agent</dfn> is any software that is capable of requesting an action
to be performed in a way that is compliant with the PaySwarm specification.
The software is usually controlled by a person or an organization 
that would like to perform some action on a PaySwarm-conformant network.
          </p>
        </div>
        <div id="participants-1" class="section">
          <h4><span class="secno">2.2.2 </span>Participants</h4>
          <p>
A <dfn title="participant" id="dfn-participant">participant</dfn> is an entity that is capable 
of performing a transaction or acquiring the rights to a particular 
<a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> via a <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a>. 
The entity is typically a person or an organization that would like to 
transact, view, copy or otherwise utilize an asset that is being 
sold.
          </p>
        </div>
        <div id="vendors" class="section">
          <h4><span class="secno">2.2.3 </span>Vendors</h4>
          <p>
A <dfn title="vendor" id="dfn-vendor">vendor</dfn> is the entity providing an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> for sale. 
Typically, the vendor is the legal owner 
of the asset that is being listed for sale. Ownership of an asset can manifest 
in a variety of different forms. Copyright ownership, physical ownership, and 
sub-leased property or services are just a few of the types of ownership that 
apply to vendors.
          </p>
        </div>
        <div id="payswarm-authorities" class="section">
          <h4><span class="secno">2.2.4 </span>PaySwarm Authorities</h4>
          <p>
A <dfn title="authority" id="dfn-authority">authority</dfn> is used to store money, process and store 
contracts, and 
transfer monetary amounts between financial accounts. While a PaySwarm 
Authority may hold a great deal of financial data, they are built with
data portability in mind. PaySwarm participants may move their money and
purchase history from one authority to another. Data portability is a mandatory
part of this specification.
          </p>
        </div>
      </div>
      <div id="commerce-model" class="section">
        <h3><span class="secno">2.3 </span>Commerce Model</h3>
        <div id="transactions" class="section">
          <h4><span class="secno">2.3.1 </span>Transactions</h4>
A <dfn title="transaction" id="dfn-transaction">transaction</dfn> is the exchange of value from one or more 
source accounts into one or more destination accounts.
        </div>
        <div id="assets" class="section">
          <h4><span class="secno">2.3.2 </span>Assets</h4>
An <dfn title="asset" id="dfn-asset">asset</dfn> describes a particular item that is provided as a part 
of a commercial
transaction. It is usually an item that can be accessed or acquired on the
basis of a sale or rental under the terms of a particular license. Examples
of assets include web pages, crowd-funded loans or grants, music files, 
video streams, use of virtual machines by the hour, 
3D printer files for on-demand manufacturing, radio 
spectrum and many other items that are capable of being transacted.
          <p>
          </p>
        </div>
        <div id="licenses" class="section">
          <h4><span class="secno">2.3.3 </span>Licenses</h4>
          <p>
A <dfn title="license" id="dfn-license">license</dfn> is a legal description of a licensee's rights to a 
particular <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>.
Licenses are usually included as a part of a contract to express what a buyer 
may do with the asset that has been purchased.
          </p>
        </div>
        <div id="listings" class="section">
          <h4><span class="secno">2.3.4 </span>Listings</h4>
          <p>
A <dfn title="listing" id="dfn-listing">listing</dfn> describes the combination of an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that 
is for sale under a specific <a class="tref internalDFN" title="license" href="#dfn-license">license</a> and a set of payment terms 
that must be fulfilled in order 
to access the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>. Listings are often published on websites that 
sell <a class="tref" title="assets">assets</a> via PaySwarm as a way to express wares for sale in a 
decentralized manner.
          </p>
        </div>
        <div id="contracts" class="section">
          <h4><span class="secno">2.3.5 </span>Contracts</h4>
          <p>
A <dfn title="contract" id="dfn-contract">contract</dfn> is the result of a commercial transaction in PaySwarm 
and contains
information such as the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>, the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was 
purchased, the parties involved in the transaction, the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> 
outlining the rights to the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>, and payment information 
associated with the transaction.
          </p>
        </div>
      </div>      
    </div>

    <div id="base-technologies" class="section">
      
<!-- OddPage -->
<h2><span class="secno">3. </span>Base Technologies</h2>
      <p>
PaySwarm builds on a number of successful Internet and Web technologies. These
technologies are introduced in this section.
      </p>

      <div id="representational-state-transfer" class="section">
        <h3><span class="secno">3.1 </span>Representational State Transfer</h3>
        <p>
REpresentational State Transfer [<cite><a class="bibref" rel="biblioentry" href="#bib-REST">REST</a></cite>] is the architectural style that underpins
the World Wide Web. It consists of a set of constraints to ensure that servers,
gateways, proxies and clients may interact in a way that is predictable.
Systems that are designed with this architecture in mind are called RESTful
systems. PaySwarm is designed to be RESTful by ensuring that the constraints of
REST are applied to all transactions performed via PaySwarm systems.
        </p>
      </div>

      <div id="javascript-object-notation-for-linking-data" class="section">
        <h3><span class="secno">3.2 </span>JavaScript Object Notation for Linking Data</h3>
        <p>
JavaScript Object Notation for Linking Data [<cite><a class="bibref" rel="biblioentry" href="#bib-JSON-LD">JSON-LD</a></cite>] is a lightweight Linked 
Data format. It is easy for humans to read and write. It is easy for machines 
to parse and generate. It is based on the already successful JSON format and 
provides a way to help JSON data interoperate at Web-scale. If you are already 
familiar with JSON, writing JSON-LD is very easy. There is a smooth migration 
path from the JSON you use today, to the JSON-LD you will use in the future. 
These properties make JSON-LD an ideal Linked Data interchange language for 
JavaScript environments, Web services, and JSON document-based databases.
        </p>
      </div>

      <div id="the-advanced-encryption-standard" class="section">
        <h3><span class="secno">3.3 </span>The Advanced Encryption Standard</h3>
        <p>
The Advanced Encryption Standard (AES) [<cite><a class="bibref" rel="biblioentry" href="#bib-FIPS-197">FIPS-197</a></cite>] is a world standard 
adopted by the
United States Government and used to secure a vast majority of the
commercial transactions over the Internet via OpenSSL. Since much of the data
exchanged over PaySwarm participants is sensitive, it is important that a 
strong cryptography suite is utilized to digitally sign and transfer the 
messages.
        </p>
      </div>

      <div id="html-rdfa" class="section">
        <h3><span class="secno">3.4 </span>HTML+RDFa</h3>
        <p>
Web sites are largely implemented on top of the HyperText Markup Language 
(HTML). This format is known to be fairly easy to author and publish on the Web.
In addition to being easy to publish, it is also important that data published
via HTML can be easily read by machines without placing an undue burden on
Web authors. Publishing structured data in a decentralized manner also 
requires a language that is capable of being both expressive and deterministic. 
The Resource Description Framework in attributes [<cite><a class="bibref" rel="biblioentry" href="#bib-RDFA-CORE">RDFA-CORE</a></cite>] extends HTML 
[<cite><a class="bibref" rel="biblioentry" href="#bib-HTML-RDFA">HTML-RDFA</a></cite>] to allow structured data to be expressed via HTML, but in a way 
that is easy for Web developers to author.
        </p>
      </div>
    </div>

    <div id="communication" class="section">
      
<!-- OddPage -->
<h2><span class="secno">4. </span>Communication</h2>
      <p>
All communication between software operating under this specification is
intended to perform according to REST [<cite><a class="bibref" rel="biblioentry" href="#bib-REST">REST</a></cite>] principles. Additionally, since
PaySwarm implements a financial system, the security of messages and data
is of paramount importance. A security breach at certain points during the 
algorithms described in the following sections may introduce attack vectors 
that criminals could utilize to steal from or cause financial harm to the 
systems or people involved. However, excellent security does not have to 
come at a high cost. PaySwarm has been designed so that many parts of the 
system can be implemented in a way that does not incur significant 
effort, recurring costs, or financial outlay.
      </p>

      <div id="requests-and-responses" class="section">
        <h3><span class="secno">4.1 </span>Requests and Responses</h3>
        <p>
This specification requires that a <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> 
have a trusted security certificate and operate many of the API services over 
Transport Layer Security version 1.0 or later. Unless otherwise 
specified, all API requests
<em class="rfc2119" title="must">must</em> be made over HTTPS to the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
        </p>
        <p>
An invalid certificate or TLS error or any kind <em class="rfc2119" title="must">must</em> result in the API 
call exiting immediately and not performing the requested
action. All API requests sent to the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> on 
behalf of a participant of the network that results in any modification 
to an internal database <em class="rfc2119" title="must">must</em> be digitally signed by the requestor using the
steps provided in the <a href="#request-signature-algorithm">Request Signature
Algorithm</a>. All responses to network participants from a
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> be encrypted according to the steps
provided in the
<a href="#response-encryption-algorithm">Response Encryption Algorithm</a>.
        </p>
      </div>

      <div id="communication-terms" class="section">
        <h3><span class="secno">4.2 </span>Communication Terms</h3>
        <p>
The following terminology is used to describe concepts used to generate and 
secure messages in the system. Many of these terms are borrowed from 
public/private key cryptography. A more complete description of public/private 
cryptography can be found in The Advanced Encryption Standard [<cite><a class="bibref" rel="biblioentry" href="#bib-AES">AES</a></cite>].
        </p>
        
        <dl>
          <dt><dfn title="message" id="dfn-message">message</dfn></dt>
          <dd>
A JSON-LD byte stream that is used to convey a request or a response in the 
system.
          </dd>
          <dt><dfn title="public_key" id="dfn-public_key">public key</dfn></dt>
          <dd>
A cryptographic mechanism that can be used to verify digital signatures or
encrypt small messages such that only the software with access to the
corresponding <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> can decrypt the small message.
          </dd>
          <dt><dfn title="private_key" id="dfn-private_key">private key</dfn></dt>
          <dd>
A cryptographic mechanism that can be used to generate digital signatures and
decrypt encrypted data.
          </dd>
          <dt><dfn title="signed_message" id="dfn-signed_message">signed message</dfn></dt>
          <dd>
A type of message that has a digital signature attached to it, generated using
a <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>, that is verifiable and incredibly difficult to
forge.
          </dd>
          <dt><dfn title="intermediate_value" id="dfn-intermediate_value">intermediate value</dfn></dt>
          <dd>
A cryptographic input to an encryption algorithm. This is typically a 16-byte
value in AES.
          </dd>
          <dt><dfn title="encrypted_message" id="dfn-encrypted_message">encrypted message</dfn></dt>
          <dd>
A type of message that has been obfuscated using a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>,
which is incredibly difficult to decode by any person except for the one
that holds the associated <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>.
          </dd>
        </dl>
        
      </div>

      <div id="request-signature-algorithm" class="section">
        <h3><span class="secno">4.3 </span>Request Signature Algorithm</h3>
        <p>
The following algorithm ensures that the originator of an API call can be
verified as long as the public key can be retrieved by the receiver. A
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> is provided as input and, using a
<a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> and a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI, a
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Remove any <code>sec:signature</code> key-value pair from the top-level of the
<a class="tref internalDFN" title="message" href="#dfn-message">message</a>. Copy the <a class="tref internalDFN" title="message" href="#dfn-message">message</a> to the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>.
          </li>
          <li>
Generate the <dfn title="normalized_message" id="dfn-normalized_message">normalized message</dfn> by normalizing the 
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
          </li>
          <li>
Generate the <dfn title="signature_value" id="dfn-signature_value">signature value</dfn> by:
            <ol class="algorithm">
              <li>
Create a <dfn title="timestamped_message" id="dfn-timestamped_message">timestamped message</dfn> and initialize it to the
emtpy string. Generate an  ISO8601 <dfn title="combined_date_and_time_string" id="dfn-combined_date_and_time_string">combined date and time string</dfn> 
containing the current date and time, accurate to at least one second, in 
Universal Time Code format. For example: <code>2011-09-23T20:21:34Z</code>. 
Append the <a class="tref internalDFN" title="combined_date_and_time_string" href="#dfn-combined_date_and_time_string">combined date and time string</a> to the 
<a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a>. Append the <a class="tref internalDFN" title="normalized_message" href="#dfn-normalized_message">normalized message</a> 
to the <a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a>.
              </li>
              <li>
Digitally sign the <a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a> using the 
<a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> and then base-64 encode the resulting value. The 
resulting base-64 encoded string is the <a class="tref internalDFN" title="signature_value" href="#dfn-signature_value">signature value</a>.
              </li>
            </ol>
          </li><li>
Add a <code>sec:signature</code> key to the <a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> with
a JSON object containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code></dt><dt>
              </dt><dd><code>sec:JsonLdSignature</code></dd>
              <dt><code>dc:created</code></dt><dt>
              </dt><dd>
The string value of the <a class="tref internalDFN" title="combined_date_and_time_string" href="#dfn-combined_date_and_time_string">combined date and time string</a> generated
by this algorithm.
              </dd>
              <dt><code>sec:responseToken</code></dt><dt>
              </dt><dd>
A string value that will be encoded in the encrypted response to the requesting
agent. It is <em class="rfc2119" title="recommended">recommended</em> that this value is a session identifier that is 
associated with the user agent that initiated the request, plus a hyphen, 
plus a cryptographically secure random string used as a one-time pad. 
For example, <code>jf793ksj72jkf-78p82qpj87dnd2f839</code>. See 
<a href="#the-response-token">The Response Token</a> section to understand 
more about how this value is used to prevent replay attacks and its accepted
limitations.
              </dd>
              <dt><code>sec:publicKey</code></dt><dt>
              </dt><dd>The value of the input <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI.</dd>
              <dt><code>sec:signatureValue</code></dt><dt>
              </dt><dd>
The value of the <a class="tref internalDFN" title="signature_value" href="#dfn-signature_value">signature value</a> generated by this algorithm.
              </dd>
            </dl>
          </li>
        </ol>

        <p>
The following example shows an input <a class="tref internalDFN" title="message" href="#dfn-message">message</a> and the resulting
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>:
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">*** message
{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">Hello World!</span><span class="pln">"
}

*** signed message
{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">Hello World!</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">":
   {
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">sec:JsonLdSignature</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-09-23T20:21:34Z</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signer</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/john/keys/5</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">OGQzNGVkMzVm4NTIyZTkZDYMmMzQzNmExMgoYzI43Q3ODIyOWM32NjI=</span><span class="pln">"
   }
}
        </span></pre>

      </div>

      <div id="request-signature-verification-algorithm" class="section">
        <h3><span class="secno">4.4 </span>Request Signature Verification Algorithm</h3>
        <p>
In order to ensure a secure communication environment the following algorithm
<em class="rfc2119" title="should">should</em> be used to verify all request signatures in the system. A
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> is provided as input and an indication of whether
the signature is valid or a forgery is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Generate the <dfn title="original_message" id="dfn-original_message">original message</dfn> by copying the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> and removing the <code>sec:signature</code> value
from the <a class="tref internalDFN" title="original_message" href="#dfn-original_message">original message</a>.
          </li>
          <li>
Generate the <dfn title="original_normalized_message" id="dfn-original_normalized_message">original normalized message</dfn> by normalizing the 
<a class="tref internalDFN" title="original_message" href="#dfn-original_message">original message</a> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
          </li>
          <li>
Verify the <dfn title="original_signature_value" id="dfn-original_signature_value">original signature value</dfn>:
            <ol class="algorithm">
              <li>
Generate the <dfn title="original_timestamped_message" id="dfn-original_timestamped_message">original timestamped message</dfn> by setting its value to 
the value of the <code>dc:created</code> key in the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>. Append the
<a class="tref internalDFN" title="original_normalized_message" href="#dfn-original_normalized_message">original normalized message</a> to the 
<a class="tref internalDFN" title="original_timestamped_message" href="#dfn-original_timestamped_message">original timestamped message</a>.
              </li>
              <li>
Retrieve the PEM-encoded <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> from the
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI provided in
<code>sec:signer</code> value. The <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> <em class="rfc2119" title="may">may</em> also be retrieved
from a cache. ???Verify the <a class="tref" title="original_nonced_message">original nonced message</a>
using the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>??? 
<div class="note">We need to be more explicit about what is happening here.</div>
              </li>
            </ol>
        </li></ol>
      </div>

      <div id="response-encryption-algorithm" class="section">
        <h3><span class="secno">4.5 </span>Response Encryption Algorithm</h3>
        <p>
The following algorithm ensures that a message intended for a particular
recipient can be obfuscated such that only the intended recipient can read the
message. A <a class="tref internalDFN" title="message" href="#dfn-message">message</a> is provided as input and, using a
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> and a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI, a 
<a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> is produced as output.
        </p>

        <ol class="algorithm">
          <li>
Generate a 
<a href="http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">cryptographically secure</a> 
<dfn title="symmetric_key" id="dfn-symmetric_key">symmetric key</dfn> that is exactly 16 bytes in length.
          </li>
          <li>
Generate a 
<a href="http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">cryptographically secure</a>
<a class="tref" title="initialization_vector">initialization vector</a> that is exactly 16 bytes in length.
          </li>
          <li>
Generate the <dfn title="encrypted_initialization_vector" id="dfn-encrypted_initialization_vector">encrypted initialization vector</dfn> by using the
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> to encrypt the <a class="tref" title="initialization_vector">initialization vector</a>.
          </li>
          <li>
Generate the <dfn title="encrypted_data" id="dfn-encrypted_data">encrypted data</dfn> by encrypting the <a class="tref internalDFN" title="message" href="#dfn-message">message</a>
using the RSA with AES 128-bit Cyclic Block Chaining algorithm, using the
<a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a> and the <a class="tref" title="initialization_vector">initialization vector</a>
generated previously in this algorithm.
          </li>
          <li>
Generate the <dfn title="encrypted_symmetric_key" id="dfn-encrypted_symmetric_key">encrypted symmetric key</dfn> by using the 
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> to encrypt the <a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a>.
          </li>
Generate the <a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> by creating a JSON object
containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code></dt><dt>
              </dt><dd><code>sec:EncryptedMessage</code></dd>
              <dt><code>sec:data</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref internalDFN" title="encrypted_data" href="#dfn-encrypted_data">encrypted data</a>.
              </dd>
              <dt><code>sec:encryptionKey</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref" title="encrypted_key">encrypted key</a>.
              </dd>
              <dt><code>sec:cipher</code></dt><dt>
              </dt><dd>
The value <code>rsa-aes-128-cbc</code>.
              </dd>
              <dt><code>sec:iv</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref internalDFN" title="encrypted_initialization_vector" href="#dfn-encrypted_initialization_vector">encrypted initialization vector</a>.
              </dd>
              <dt><code>sec:publicKey</code></dt><dt>
              </dt><dd>
The <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>
that was used to encrypt the <a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a> in this
algorithm.
              </dd>
            </dl>
          
        </ol>

        <p>
The following example shows a typical input message and what an encrypted
message looks like when generated using the algorithm above.
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">*** message
{
   "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:Preferences</span><span class="pln">"
   "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:minimumAmount</span><span class="pln">": "</span><span class="str">0.05</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:maximumRate</span><span class="pln">": "</span><span class="str">10.0</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://example.com/people/manu/accounts/article-sales</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:publicKey</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/manu/keys/23</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:license</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/licenses/blogging</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:licenseHash</span><span class="pln">": "</span><span class="str">961ec496092bf6ee08d6255d96069b5186332689</span><span class="pln">",
}

*** encrypted message
{
   "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">sec:EncryptedMessage</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:data</span><span class="pln">": "</span><span class="str">VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:encryptionKey</span><span class="pln">": "</span><span class="str">uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:cipher</span><span class="pln">": "</span><span class="str">rsa-aes-128-cbc</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:iv</span><span class="pln">": "</span><span class="str">vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:publicKey</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/manu/keys/23</span><span class="pln">"
}
        </span></pre>
        
      </div>
      
      <div id="response-decryption-algorithm" class="section">
        <h3><span class="secno">4.6 </span>Response Decryption Algorithm</h3>
        <p>
The following algorithm is used to decrypt an encrypted response. The input
is an <a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> and the result is the 
<dfn title="original_unencrypted_message" id="dfn-original_unencrypted_message">original unencrypted message</dfn>.
        </p>
        
        <ol class="algorithm">
          <li>
Generate the <dfn title="decryption_key" id="dfn-decryption_key">decryption key</dfn> by base-64 decoding the
<code>sec:encryptionKey</code> value and using the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>
associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI in
<code>sec:publicKey</code> to decrypt the base-64 decoded value.
<div class="issue">Refer to the exact algorithm that is used to do the
decryption in the AES spec.</div>
          </li>
          <li>
Generate the <a class="tref internalDFN" title="intermediate_value" href="#dfn-intermediate_value">intermediate value</a> by base-64 decoding the
<code>sec:iv</code> value and then using the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>
associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI in
<code>sec:publicKey</code> to decrypt the base-64 decoded value.
          </li>          
          <li>
Generate the <dfn title="original_unencrypted_message" id="dfn-original_unencrypted_message-1">original unencrypted message</dfn> by applying the
<code>sec:cipher</code> to the <code>sec:data</code> value. Use the
<a class="tref internalDFN" title="decryption_key" href="#dfn-decryption_key">decryption key</a> and <a class="tref internalDFN" title="intermediate_value" href="#dfn-intermediate_value">intermediate value</a> generated in
this algorithm as inputs to the cipher algorithm.
          </li>
        </ol>
      </div>

      <div id="security-considerations" class="section">
        <h3><span class="secno">4.7 </span>Security Considerations</h3>
        <p>
Since this specificationd describes a financial system, the security of the
communication in the system is of utmost importance. The following section
describes security considerations that developers implementing this 
specification should be aware of in order to create secure software.
        </p>

        <div id="the-response-token" class="section">
        <h4><span class="secno">4.7.1 </span>The Response Token</h4>        
          <p>
The <code>sec:responseToken</code> mechanism is used in order to prevent
replay attacks, but implementers must be aware that it is not capable of 
preventing man-in-the-middle attacks. Only a full end-to-end encryption channel
is capable of accomplishing that feat and if implementers are concerned about
man-in-the-middle attacks, they are strongly advised to run all callbacks
over HTTPS.
          </p>
          <p>
While implementation of the response 
token to prevent replay attacks is left as an exercise to the developer, it
is advised that it is treated as a one-time token. That is, when a response
token is sent from one peer to another peer, the sender must note the
response token in an internal database. When the response token is returned in
an encrypted message, the response token must be deleted from the internal
database so all successive calls using the same response token will fail.
This simple behavior prevents replay attacks and is simpler to implement than
a security nonce.
          </p>
          <p>
To further increase security, it is advised that the response token is tied to
the originating client's IP address in some way. The resulting response callback
should be executed by the same client's IP address, thus many classes of 
man-in-the-middle attacks can be prevented, requiring quite a sophisticated 
attack in order to hijack the response. Note that the hijacker will not be able 
to modify the response, but merely callback-jack the response. The result of
the callback-jack would be fairly benign in most cases - gaining access
to an article that was purchased by the original user agent that initiated
the request. The original purchaser will still have access
to the article, so the only damage done is the ability to view or download an
article as someone else. If this is a concern to implementers, they are advised
to purchase a valid SSL certificate and ensure that all callbacks to their site
occur over SSL.
          </p>
        </div>
      
      </div>
      
    </div>

    <div id="the-registration-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">5. </span>The Registration Process</h2>
      <p>
The registration process is necessary in order to specify details about
the participants in a PaySwarm transaction.
      </p>

      <div id="registration-terms" class="section">
        <h3><span class="secno">5.1 </span>Registration Terms</h3>
        <p>
There are a number of terms that are used during the course of the registration
process.
        </p><dl>
        <dt><dfn title="user_agent" id="dfn-user_agent">user agent</dfn></dt>
        <dd>The piece of software operating on behalf of the 
<a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>. This is typically a Web Browser, but could be
some other piece of Web-aware automated software acting on behalf of a 
person.</dd>
        <dt><dfn title="publishing_agent" id="dfn-publishing_agent">publishing agent</dfn></dt>
        <dd>A software agent acting on behalf of the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a>
that publishes <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s for sale. Typically, this is blogging
software, content distribution software, online merchant software or a Web-based
game.</dd>
        <dt><dfn title="configuration_service" id="dfn-configuration_service">configuration service</dfn></dt>
        <dd>A Web service that is used to publish the public Web service
end-points and other public configuration information for a
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. An <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em>
publish this service at a top-level IRI named <code>payswarm-v1-config</code>. 
The document <em class="rfc2119" title="must">must</em> be available in JSON-LD compacted form and <em class="rfc2119" title="must">must</em> use the
<code>http://purl.org/payswarm/v1</code> JSON-LD context. The following
keys <em class="rfc2119" title="must">must</em> be present in the published document; 
<code>ps:publicKeyService</code>, <code>ps:licenseService</code>, and
<code>ps:transactionService</code>.</dd>
        <dt><dfn title="public_key_registration_service" id="dfn-public_key_registration_service">public key registration service</dfn></dt>
        <dd>An interactive Web service used to register PEM-encoded 
X.509 public keys with the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.</dd>
        <dt><dfn title="license_service" id="dfn-license_service">license service</dfn></dt>
        <dd>A utility service is used by a <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>s 
to retrieve license hashes, which are used when listing <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s 
for sale.</dd>
        <dt><dfn title="contracts_service" id="dfn-contracts_service">contracts service</dfn></dt>
        <dd>The contract service is used to process purchases by submitting
and retrieving digital contracts.</dd>
        </dl>
        <p></p>
      </div>

      <div id="buyer-registration" class="section">
        <h3><span class="secno">5.2 </span>Buyer Registration</h3>
        <p>
In order for a <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> to transact, they must have an
account on a <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. Typically, this account must 
also contain a positive amount of funds that may be used to acquire goods or 
services. How this account is created and funds are deposited are outside of
the scope of this specification. However, the end result of this sign up
process <em class="rfc2119" title="must">must</em> result in the following items being created for the
<a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>:
        </p>
        <ol>
          <li>An <dfn title="identity" id="dfn-identity">identity</dfn> IRI that will be used to identify the 
entity that is transacting. For example: 
<code>https://example.com/people/jane</code>.</li>
          <li>A <dfn title="financial_account" id="dfn-financial_account">financial account</dfn> IRI that is associated with the 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> IRI above. For example:
<code>https://example.com/people/jane/accounts/primary</code>.</li>
          <li>A positive amount of funds in the <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>
mentioned above.
        </li></ol>
      </div>

      <div id="vendor-registration" class="section">
        <h3><span class="secno">5.3 </span>Vendor Registration</h3>
        <p>
In order for a <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> to transact, they must have an
account on a authority. How this account is created and managed is
outside of the scope of this specification. However, the end result of this
sign up process <em class="rfc2119" title="must">must</em> result in the following items being created for the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a>:
        </p>
        <ol class="algorithm">
          <li>An <dfn title="identity" id="dfn-identity-1">identity</dfn> IRI that will be used to identify the 
entity that is transacting. For example: 
<code>https://example.com/people/manu</code>.</li>
          <li>A <dfn title="financial_account" id="dfn-financial_account-1">financial account</dfn> IRI that is associated with the 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> IRI above. For example:
<code>https://example.com/people/manu/accounts/article-sales</code>.</li>
        </ol>
        <p>
Since all <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s and <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>s are digitally signed,
a public key <em class="rfc2119" title="must">must</em> be registered for the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> with the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
This is typically performed by the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> software that 
is publishing the 
<a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s and <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>s for sale on behalf of the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a>. The registration is accomplished by executing
the following algorithm:
        </p><ol class="algorithm">
          <li>The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> generates and stores a 
public/private keypair that will be used to associate the
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> with the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a>.</li>
          <li>The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> retrieves the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> configuration from the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI.
            <ol class="algorithm">
              <li>The <a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI is generated 
by concatenating a base IRI for the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>, 
such as <code>https://example.com/</code> with the 
<code>payswarm-v1-config</code> suffix. 
For example, the previous <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> IRI concatenated 
with the configuration suffix would result in the following 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a>
IRI: <code>https://example.com/payswarm-v1-config</code>.</li>
              <li>An HTTPS GET is performed on the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI with the
HTTP <code>Accept</code> header set to 
<code>application/ld+json; form=compacted</code>. The
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> respond with a compacted JSON-LD document
using the context specified at <code>http://purl.org/payswarm/v1</code>.</li>
              <li>The result <em class="rfc2119" title="must">must</em> be a JSON-LD document containing a flat set of
key-value pairs defined in the <a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> section above.
              </li>
            </ol>
          </li>
          <li>
The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> initiates an HTTP 302 redirect
for the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>. An HTTPS GET request is performed
to the <a class="tref internalDFN" title="public_key_registration_service" href="#dfn-public_key_registration_service">public key registration service</a> IRI with the addition of 
two IRI query parameters. The first parameter, <code>public-key</code>, is the 
URL-encoded X.509 PEM-encoded public key. The second parameter, 
<code>registration-callback</code>,
is the URL-encoded <a class="tref" title="registration_callback_service">registration callback service</a> 
IRI for the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>.</li>
          <li>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> associates the 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> with the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> based on the
provided public key. Note that this process <em class="rfc2119" title="must">must</em> authenticate the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> via a login process if the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> does not have an active login session. Other
configuration steps may be performed at this stage, including the 
specification of defaults for the particular <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>.</li>
          <li>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> specifies a set of 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> configuration values and encrypts the 
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> according to the steps outlined in
the <a href="#response-encryption-algorithm">Response Encryption Algorithm</a>
section. The result is sent 
back to the <code>registration-callback</code> IRI via a POST 
initiated by the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>.
            <ol class="algorithm">
              <li>The following configuration values <em class="rfc2119" title="must">must</em> be included in the
JSON-LD response to the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>; 
<code>com:currency</code>, <code>com:minimumAmount</code>, 
<code>com:maximumRate</code>, <code>com:destination</code>, 
<code>sec:publicKey</code>, <code>ps:license</code> and 
<code>ps:licenseHash</code>.
              </li>
              <li>The JSON-LD response is compacted and encrypted using the
public key associated with the registration request according to the
algorithm defined in
<a href="#response-encryption-algorithm">Response Encryption Algorithm</a>.
              </li>
              <li>The <a class="tref" title="encrypted_response">encrypted response</a> is transmitted to the
<code>registration-callback</code> via an HTTP POST request that is initiatited
by the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>. This is most commonly accomplished by having
the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> generate an HTML form that can be submitted
to the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> when a form submission button is clicked
via the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>.
              </li><li>The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> decrypts the base-64
encoded byte stream, extracts the configuration values and stores each value
for use during the latter parts of the publishing and purchase process.</li>
            </ol>
          </li>
        </ol>
        <p></p>

        <p>
The example below shows the full protocol-level exchange between the
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> and the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. For
the sake of brevity, not every optional parameter is included, just the bare
minimum necessary to perform the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> registration.
        </p>

<pre class="example">
--------------------------------- Step #1 -----------------------------------

*** Request: user agent -&gt; publishing agent

POST /register-blog HTTP/1.1
Host: publisher.example.org
Content-Length: 47
Content-Type: application/x-www-form-urlencoded

payswarm-authority=http%3A%2F%2Fpayswarm.example.com%2F

*** publishing agent generates and stores public/private keypair

-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il
0LXJrhUY43V/lLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2
B5u4m0LtXyaFWtbQV9+hY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B
US89y0M909ZTj2zDQwIDAQAB
-----END PUBLIC KEY-----

-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il0LXJrhUY43V/lLWdRf7JXY6t
cgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2B5u4m0LtXyaFWtbQV9+hY3JR
LOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0BUS89y0M909ZTj2zDQwIDAQAB
AoGALNmBrVgHEk4T0qH+XihTjThlZ7Tq/h5TXChipy5BwEHriHdU50JGeqpVVBpC
68gj5Hd8OGss8vPEiRBeqN0mhJlRaX5ijyFp2n8+7DhfOIVhCd1MXCGQPTrdXIo5
OOQECSplnALZfKr0VC4TBeW+oUZGMoG4rRSM5DfyPFJtlzECQQD8DkWBkhRsP1An
3qfZR8oUkvbaVg9jsCNvoBazYSS3OhsZ96ZSTyf9hJn28wGJmShuZA2eL5XjuTY4
m0fQDhj5AkEA7VzAqKOx5zlFTWXMIzn29uB59m4yJ7UwCyc7tisQA16I8B2HzJzZ
saipkpU2RUYaBrjtWaiVNtyXvZ7mccJpGwJBAMyE4/8bwfiHcwm2z+ktKBqDmUtW
E0ynKkmz01ef1kPaIQ1z9f/JfMBnrOpFCZVVsgnIo4gcQnox2X4a+S0nkzkCQBre
xCSTG2Gclx7S5lAakL2T3dqq0Nyz4zNwBo9xwodPHVtpTGU6YF5/RGsGnzUqYWnf
Z2cd8X5bbIYXxeic5H8CQQCcBOtOdrq9FXsEnyhG5gQXvGdxEAmM2eUs1g8E8kgx
KBTHOaBRQMgvjsdA/obrs7D0HrEbQqGOy7JBYGWZTsiI
-----END RSA PRIVATE KEY-----

--------------------------------- Step #2 -----------------------------------

*** Request: publishing agent -&gt; authority

GET /payswarm-v1-config HTTP/1.1
Host: payswarm.example.com
Accept: application/ld+json,*/*;q=0.1

*** Response: publishing agent &lt;- authority

HTTP/1.1 200 OK
Connection: close
Content-Length: 6075
Content-Type: application/ld+json
Date: Wed, 21 Sep 2012 22:30:16 GMT
Host: payswarm.example.com
Server: Apache/2.2.19 (Debian)

{
   "@context": "http://purl.org/payswarm/v1",
   "@id": "http://payswarm.example.com/i/authority",
   "ps:registrationService": "http://payswarm.example.com/api/v1/applications",
   "ps:publicKeyService": "http://payswarm.example.com/api/v1/keys",
   "ps:licenseService": "http://payswarm.example.com/api/v1/licenses",
   "ps:transactionService": "http://payswarm.example.com/api/v1/contracts"
}

--------------------------------- Step #3 -----------------------------------

*** Redirect: user agent &lt;- publishing agent

HTTP/1.1 303 See Other
Location: https://payswarm.example.com/api/v1/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fpublisher.example.org%2Fregistration-complete?nonce=pn9sueh43jefa
Content-Type: text/html
Content-Length: 174

&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Identity Registration&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;h1&gt;Public Key Registration&lt;/h1&gt;
   &lt;p&gt;You must now go to your authority and 
    &lt;a href="http://payswarm.example.com/api/v1/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fpublisher.example.org%2Fregistration-complete?nonce=pn9sueh43jefa"&gt;
    register your identification information&lt;/a&gt; 
    there.&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;

--------------------------------- Step #4 -----------------------------------

*** This step consists of a series of UI interactions and is thus not
*** specified in this specification.

--------------------------------- Step #5 -----------------------------------

*** The authority creates a configuration object to return back
*** to the publishing agent

{
   "@type": "ps:Preferences"
   "com:currency": "USD",
   "com:minimumAmount": "0.05",
   "com:maximumRate": "10.0",
   "com:destination": "https://example.com/people/manu/accounts/article-sales",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23",
   "ps:license": "http://purl.org/payswarm/licenses/blogging",
   "ps:licenseHash": "961ec496092bf6ee08d6255d96069b5186332689",
}

*** The configuration object is then encrypted and sent to the 
*** registration-callback specified in the registration request above.

POST registration-complete?nonce=pn9sueh43jefa HTTP/1.1
Host: publisher.example.org
Content-Length: 47
Content-Type: application/ld+json

{
   "@type": "sec:EncryptedMessage",
   "sec:data": "VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==",
   "sec:encryptionKey": "uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=",
   "sec:cipher": "aes-128-cbc",
   "sec:iv": "vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==",
   "sec:publicKey": "http://payswarm.example.com/i/manu/keys/23"
}</pre>
      </div>

      <div id="security-concerns-for-registration" class="section">
        <h3><span class="secno">5.4 </span>Security Concerns for Registration</h3>

        <ul>
          <li>
All requests to the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> be made using HTTPS
to ensure configuration data is not tampered with in transit.
          </li>
          <li>
The registration request from the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> to the
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> contain a <a class="tref" title="nonce">nonce</a> value
for the <code>registration-callback</code> IRI to protect the 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> against 
<a href="http://en.wikipedia.org/wiki/Replay_attack">replay attacks</a>.
          </li>
        </ul>

      </div>
    </div>

    <div id="the-transaction-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">6. </span>The Transaction Process</h2>

      <p>
The simplest exchange of value that can happen in the PaySwarm system is a
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>. 
      </p>
      
      <div id="transaction-terms" class="section">
        <h3><span class="secno">6.1 </span>Transaction Terms</h3>
        <p>
There are a number of terms that are used during the course of processing a
transaction.
        </p>

        <dl>
          <dt><dfn title="transaction_service" id="dfn-transaction_service">transaction service</dfn></dt>
          <dd>
The service endpoint identified by the <code>ps:transactionService</code> key in
the domain's PaySwarm configuration file. The configuration file can be fetched
by performing an HTTP GET request on the <a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a>
IRI.
          </dd>
          <dt><dfn title="transaction_request" id="dfn-transaction_request">transaction request</dfn></dt>
          <dd>
A JSON-LD formatted object that contains all of the necessary information
required to initiate a <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> on a PaySwarm-conformant
network.
          </dd>
          <dt><dfn title="transfer" id="dfn-transfer">transfer</dfn></dt>
          <dd>
A JSON-LD formatted object that specifies the movement of value from a
source account to a destination account.
          </dd>
        </dl>
      </div>

      <div id="the-transaction-algorithm" class="section">
        <h3><span class="secno">6.2 </span>The Transaction Algorithm</h3>

        <p>
There are two ways in which a Transaction may be initiated via a 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>; Payment Link initiated and <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a>
initiated. The first approach is where a <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> may 
initiate a transaction by constructing a URL targeted to the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>'s <a class="tref internalDFN" title="transaction_service" href="#dfn-transaction_service">transaction service</a> using the 
<a href="http://payswarm.com/specs/source/payment-links/">Payment Links specification</a>. 
The second approach is where an <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a> may initiate a transaction by
performing an HTTPS POST of JSON-LD object expressing a
<code>ps:Transaction</code>. The normative algorithm for performing this
operation is detailed below. In both approaches, the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> processesing the request <em class="rfc2119" title="must">must</em> note the 
<code>ps:Transaction</code> entry in all of the accounts associated in the 
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> and ensure that all accounts external to the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> are notified via the 
<a href="#decentralized-settlement-algorithm">Decentralized Settlement Algorithm</a>.
        </p>

        <p>
The normative algorithm for performing an <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a>-initiated 
transaction is expressed below.
        </p>
        
        <ol class="algorithm">
          <li>
An <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a> <em class="rfc2119" title="must">must</em> construct a <a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a> in
JSON-LD format containing at least the following:
            <dl>
              <dt><code>@context</code></dt>
              <dd>
A single value containing the string <code>http://purl.org/payswarm/v1</code> 
or a list containing that context IRI as the first member, where subsequent 
context declarations <em class="rfc2119" title="must not">must not</em> override any values in the first member.
              </dd>
              <dt><code>@type</code></dt>
              <dd>
The value <code>ps:Transaction</code>.
              </dd>
              <dt><code>com:transfer</code></dt>
              <dd>
One or more <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s in JSON-LD format containing at least the 
following:
                <dl>
                  <dt><code>@type</code></dt>
                  <dd>
The value <code>ps:Transfer</code>.
                  </dd>        
                  <dt><code>com:amount</code></dt>
                  <dd>
A string value of the total amount of the transfer.
                  </dd>        
                  <dt><code>com:currency</code></dt>
                  <dd>
The currency associated with the amount of the transfer. The value <em class="rfc2119" title="must">must</em> be an 
ISO-4217 currency or a dereference-able IRI to a monetary system that is 
not specified in ISO-4217 but follows the specification of a 
<a href="">Currency Mint</a>.
                  </dd>        
                  <dt><code>com:source</code></dt>
                  <dd>
The source account from which the funds listed in <code>com:amount</code> will
be withdrawn.
                  </dd>        
                  <dt><code>com:destination</code></dt>
                  <dd>
The destination account to which the funds listed in <code>com:amount</code> 
will be deposited.
                  </dd>        
                  <dt><code>rdfs:comment</code></dt>
                  <dd>
A string specifying the purpose of the transfer as well as other details 
intended to be read by a human.
                  </dd>
                </dl>
              </dd>
            </dl>
          </li>
          <li>
The <a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a> is digitally signed by the 
<a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a> according to the
<a href="#request-signature-algorithm">Request Signature Algorithm</a> using
a <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>
that was previously registered with the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> 
according to the 
<a href="#vendor-registration">Vendor Registration Algorithm</a>.
          </li>
          <li>
The <a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a> is sent to the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> of the <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a>
via an HTTPS connection. The HTTPS protocol <em class="rfc2119" title="must">must</em> be used for transmission 
of the request and retrieval of the response to prevent replay attacks.
          </li>
          <li>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> processes the 
<a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a>. Additional <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s <em class="rfc2119" title="may">may</em> be
added to the finalized <a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a> by the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>, such as transaction fees, pursuant to 
existing agreements between the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> and the
entity operating the <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a>. The following properties <em class="rfc2119" title="must">must</em> be added 
to the <a class="tref internalDFN" title="transaction_request" href="#dfn-transaction_request">transaction request</a>:
            <dl>
              <dt><code>@id</code></dt>
              <dd>
The finalized <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> identifier IRI. The value <em class="rfc2119" title="must">must</em> be
dereferenceable and return at least the <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> information 
returned at the end of this algorithm when accessed using a mechanism that
proves authorization to access the resource.
              </dd>
              <dt><code>com:amount</code></dt>
              <dd>
The total amount of the transaction which is calculated by adding up all of
the <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s.
              </dd>
              <dt><code>com:currency</code></dt>
              <dd>
The currency associated with the total amount of the transaction. The value 
<em class="rfc2119" title="must">must</em> be an ISO-4217 currency or a dereference-able IRI to a monetary system 
that is not specified in ISO-4217 but follows the specification of a 
<a href="">Currency Mint</a>.
              </dd>
              <dt><code>com:date</code></dt>
              <dd>
The date and time at which the transaction was recorded in the system.
              </dd>
            </dl>
          </li>
        </ol>

        <p>
The example below shows the full protocol-level exchange between the
<a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a> and the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> when performing a
Transaction:
        </p>

<pre class="example">
--------------------------------- Step #1 -----------------------------------

*** Agent creates a Transaction object

{
   "@type": "ps:Transaction"
   "ps:transfer":
   {
      "@type": "ps:Transfer",
      "com:amount": "7.50",
      "com:currency": "USD",
      "com:source": "https://bluebank.com/people/john/accounts/party-funds",
      "com:destination": "https://redbank.com/people/jane/accounts/hosting",
      "rdfs:comment": "Chipping in for the Pizza Party tomorrow."
   }
}

--------------------------------- Step #2 -----------------------------------

*** Agent signs the Transaction object

{
   "@type": "ps:Transaction"
   "ps:transfer":
   {
      "@type": "ps:Transfer",
      "com:amount": "7.50",
      "com:currency": "USD",
      "com:source": "https://bluebank.com/people/john/accounts/party-funds",
      "com:destination": "https://redbank.com/people/jane/accounts/hosting",
      "rdfs:comment": "Chipping in for the Pizza Party tomorrow."
   },
   "sec:signature":
   {
      "@type": "sec:JsonLdSignature",
      "dc:created": "2011-09-23T20:21:34Z",
      "sec:signer": "http://payswarm.example.com/i/john/keys/5",
      "sec:signatureValue": "ExMgoDIyOGQzNGVkMzVmmMzYzI43Q3OQzNmOWM32Nj4NTIyZTkZDYMI="
   }
}


---------------------------------- Step #3 ----------------------------------

*** Agent HTTPS POSTs the Transaction object to the authority

POST transactions HTTP/1.1
Host: bluebank.com
Content-Length: 634
Content-Type: application/ld+json

{
   "@type": "ps:Transaction"
   "ps:transfer":
   {
      "@type": "ps:Transfer",
      "com:amount": "7.50",
      "com:currency": "USD",
      "com:source": "https://bluebank.com/people/john/accounts/party-funds",
      "com:destination": "https://redbank.com/people/jane/accounts/hosting",
      "rdfs:comment": "Chipping in for the Pizza Party tomorrow."
   },
   "sec:signature":
   {
      "@type": "sec:JsonLdSignature",
      "dc:created": "2011-09-23T20:21:34Z",
      "sec:signer": "http://bluebank.com/people/john/keys/5",
      "sec:signatureValue": "ExMgoDIyOGQzNGVkMzVmmMzYzI43Q3OQzNmOWM32Nj4NTIyZTkZDYMI="
   }
}

---------------------------------- Step #4 ----------------------------------

*** authority processes the transaction and returns the finalized
*** transaction to the Agent

Cache-Control:no-cache, must-revalidate, max-age=0
Content-Length: 728
Content-Type: application/ld+json

{
   "@id": "https://bluebank.com/transactions/20110923f72b8ca3",
   "@type": "ps:Transaction",
   "com:amount": "7.65",
   "com:currency": "USD",
   "com:date": "2011-09-23T20:21:35Z",
   "ps:transfer":
   [{
      "@type": "ps:Transfer",
      "com:amount": "7.50",
      "com:currency": "USD",
      "com:source": "https://bluebank.com/people/john/accounts/party-funds",
      "com:destination": "https://redbank.com/people/jane/accounts/hosting",
      "rdfs:comment": "Chipping in for the Pizza Party tomorrow."
   },
   {
      "@type": "ps:Transfer",
      "com:amount": "0.15",
      "com:currency": "USD",
      "com:source": "https://bluebank.com/people/john/accounts/party-funds",
      "com:destination": "https://bluebank.com/accounts/processing-fees",
      "rdfs:comment": "Chipping in for the Pizza Party tomorrow."
   }]
}</pre>

      </div>
    </div>

    <div id="the-purchase-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">7. </span>The Purchase Process</h2>
      
      <p>
The simplest purchase process includes four distinct steps; publishing an
<a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>, publishing a <a class="tref internalDFN" title="license" href="#dfn-license">license</a>, publishing a 
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> and performing the purchase. Typically, the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> publishes the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> description and the
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>. Anyone may publish a <a class="tref internalDFN" title="license" href="#dfn-license">license</a> that is used in 
a <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>. The purchase is performed via a 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
      </p>

        <p>
While it is possible to express <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s, <a class="tref internalDFN" title="license" href="#dfn-license">license</a>s,
and <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>s on the Web in many different machine-readable 
formats, to ensure that implementations do not become more complicated than 
necessary, all <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>s, <a class="tref internalDFN" title="license" href="#dfn-license">license</a>s and 
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> <em class="rfc2119" title="must">must</em> be expressed in HTML+RDFa [<cite><a class="bibref" rel="biblioentry" href="#bib-HTML-RDFA">HTML-RDFA</a></cite>] format. The
example markup that is expressed in many of the following sections below
will use [<cite><a class="bibref" rel="biblioentry" href="#bib-JSON-LD">JSON-LD</a></cite>] for the sake of brevity. In many cases, the information
expressed via JSON-LD is expected to be express via RDFa on a Web page.
There is a clear mapping from RDFa to JSON-LD, so the data expressed in the 
sections below can be losslessly expressed via RDFa on an HTML Web page.
        </p>

      <div id="publishing-an-asset" class="section">
        <h3><span class="secno">7.1 </span>Publishing an Asset</h3>
        <p>
An <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> describes a particular item that is provided as a part 
of a commercial transaction. It is usually an item that can be accessed or 
acquired on the
basis of a sale or rental under the terms of a particular <a class="tref internalDFN" title="license" href="#dfn-license">license</a>. 
Examples of assets include web pages, music files, video streams, virtual 
machines intended to be paid for by the CPU-hour, 3D printer files for 
on-demand manufacturing, radio spectrum and crowd-funded loans and grants.
        </p>

        <p>
The following example describes a web page <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> with the title 
"PaySwarm in Practice". The article was created by 
"Digital Bazaar, Inc." and the information in the asset is valid from 
November 28th, 2010 to November 28th, 2011. 
The asset is digitally signed by the organization providing it
and thus can be cached, stored and then presented to someone else in a manner
that is verifiable by the receiving party.
        </p>
        <pre class="example prettyprint language-jsonld">
<span class="pln">{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.org/articles/1#asset</span><span class="pln">",
   "</span><span class="kwd">@type</span><span class="pln">": ["</span><span class="tag jsonld-curie">ps:Asset</span><span class="pln">", "</span><span class="tag jsonld-curie">ps:WebPage</span><span class="pln">"],
   "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">PaySwarm in Practice</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:description</span><span class="pln">": "</span><span class="str">This article covers how to use PaySwarm on your Website.</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": 
   {
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">foaf:Organization</span><span class="pln">",
      "</span><span class="atn jsonld-curie">foaf:name</span><span class="pln">": "</span><span class="str">Digital Bazaar, Inc.</span><span class="pln">",
   }
   "</span><span class="atn jsonld-curie">ps:contentUrl</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.org/articles/1</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:validFrom</span><span class="pln">": "</span><span class="tag jsonld-curie">2010-11-28T00:00:00Z</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:validUntil</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-11-28T00:00:00Z</span><span class="pln">"
   "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">": 
   {
       "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">sec:JsonLdSignature</span><span class="pln">",
       "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2010-11-28T00:00:00Z</span><span class="pln">",
       "</span><span class="atn jsonld-curie">sec:signer</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/digital-bazaar#key-5</span><span class="pln">",
       "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">OWM3YzI4OGQzNGVkMzV...IyZTk2MzQzNmExMgo=</span><span class="pln">"
   }
}
        </span></pre>
        
        <p>
In order to publish this asset on a Web page, a <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> <em class="rfc2119" title="must">must</em> 
mark the data up in RDFa and place it into an HTML file. For example,
assume that the following file is served from the 
<code>http://example.org/articles/1-purchase</code> IRI:
        </p>

        <pre class="example prettyprint language-html">
<span class="tag">&lt;html&gt;</span><span class="pln">
 </span><span class="tag">&lt;head&gt;</span><span class="pln">
   </span><span class="tag">&lt;title&gt;</span><span class="pln">Buy: PaySwarm in Practice</span><span class="tag">&lt;/title&gt;</span><span class="pln">
 </span><span class="tag">&lt;/head&gt;</span><span class="pln">
 </span><span class="tag">&lt;body</span><span class="pln"> </span><span class="atn">prefix</span><span class="pun">=</span><span class="atv">"dc: http://purl.org/dc/terms/ 
               foaf: http://xmlns.com/foaf/0.1/ 
               ps: http://purl.org/payswarm#
               sec: http://purl.org/security#
               xsd: http://www.w3.org/2001/XMLSchema#"</span><span class="tag">&gt;</span><span class="pln">

   </span><span class="tag">&lt;article</span><span class="pln"> </span><span class="atn">about</span><span class="pun">=</span><span class="atv">"http://example.org/articles/1#asset"</span><span class="pln"> </span><span class="atn">typeof</span><span class="pun">=</span><span class="atv">"ps:Asset ps:WebPage"</span><span class="tag">&gt;</span><span class="pln">
     </span><span class="tag">&lt;h1</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"dc:title"</span><span class="tag">&gt;</span><span class="pln">PaySwarm in Practice</span><span class="tag">&lt;/h1&gt;</span><span class="pln">
     by
     </span><span class="tag">&lt;h2</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"dc:creator"</span><span class="pln"> </span><span class="atn">typeof</span><span class="pun">=</span><span class="atv">"foaf:Organization"</span><span class="tag">&gt;</span><span class="pln">
       </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"foaf:name"</span><span class="tag">&gt;</span><span class="pln">Digital Bazaar, Inc.</span><span class="tag">&lt;/span&gt;</span><span class="pln">
     </span><span class="tag">&lt;/h2&gt;</span><span class="pln">

     </span><span class="tag">&lt;p</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"dc:description"</span><span class="tag">&gt;</span><span class="pln">This article covers how to use PaySwarm on your Website.</span><span class="tag">&lt;/p&gt;</span><span class="pln">
     </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"ps:contentUrl"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://example.org/articles/1"</span><span class="tag">&gt;</span><span class="pln">permalink</span><span class="tag">&lt;/a&gt;</span><span class="pln">
     
     </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">doPurchase</span><span class="pun">();</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">Purchase Access to the Article</span><span class="tag">&lt;/input&gt;</span><span class="pln">
     
     </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">toggleDetails</span><span class="pun">();</span><span class="atv">"</span><span class="tag">&gt;</span><span class="pln">Details</span><span class="tag">&lt;/input&gt;</span><span class="pln">
     </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"article-details hidden-by-default"</span><span class="tag">&gt;</span><span class="pln">
       This asset publication is valid from
       </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"ps:validFrom"</span><span class="pln"> </span><span class="atn">content</span><span class="pun">=</span><span class="atv">"2010-11-28T00:00:00Z"</span><span class="pln"> </span><span class="atn">datatype</span><span class="pun">=</span><span class="atv">"xsd:dateTime"</span><span class="tag">&gt;</span><span class="pln">today</span><span class="tag">&lt;/span&gt;</span><span class="pln">
       until a 
       </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"ps:validTo"</span><span class="pln"> </span><span class="atn">content</span><span class="pun">=</span><span class="atv">"2011-11-28T00:00:00Z"</span><span class="pln"> </span><span class="atn">datatype</span><span class="pun">=</span><span class="atv">"xsd:dateTime"</span><span class="tag">&gt;</span><span class="pln">year from today</span><span class="tag">&lt;/span&gt;</span><span class="pln">.
       </span><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"sec:signature"</span><span class="pln"> </span><span class="atn">typeof</span><span class="pun">=</span><span class="atv">"sec:JsonLdSignature"</span><span class="tag">&gt;</span><span class="pln">
         Signed on 
         </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"dc:created"</span><span class="pln"> </span><span class="atn">content</span><span class="pun">=</span><span class="atv">"2010-11-28T00:00:00Z"</span><span class="pln"> </span><span class="atn">datatype</span><span class="pun">=</span><span class="atv">"xsd:dateTime"</span><span class="tag">&gt;</span><span class="pln">November 28th 2010</span><span class="tag">&lt;/span&gt;</span><span class="pln">
         by
         </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"sec:signer"</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"https://payswarm.example.com/i/digital-bazaar#key-5"</span><span class="tag">&gt;</span><span class="pln">Digital Bazaar</span><span class="tag">&lt;/a&gt;</span><span class="pln">:
         </span><span class="tag">&lt;span</span><span class="pln"> </span><span class="atn">property</span><span class="pun">=</span><span class="atv">"sec:signatureValue"</span><span class="tag">&gt;</span><span class="pln">OWM3YzI4OGQzNGVkMzV...IyZTk2MzQzNmExMgo=</span><span class="tag">&lt;/span&gt;</span><span class="pln">
       </span><span class="tag">&lt;/div&gt;</span><span class="pln">
      </span><span class="tag">&lt;/div&gt;</span><span class="pln">
   </span><span class="tag">&lt;/article&gt;</span><span class="pln">
 </span><span class="tag">&lt;/body&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span><span class="pln">
        </span></pre>

        <p>
It may not initially be clear why an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> would need to be
digitally signed. There are two major reasons that assets <em class="rfc2119" title="must">must</em> be digitally
signed in order to take part in a secure financial system. The first is to
ensure, from a legal standpoint, that the person or organization claiming 
ownership over the asset is clear. The second is to ensure that forgery 
cannot occur on any of the asset information claimed by the owner of the asset.
For example, if the asset were listed on an non-secure HTTP-based Web site, 
the information could be easily modified in transit.
        </p>

        <p>
The example above demonstrates how the information expressed as [<cite><a class="bibref" rel="biblioentry" href="#bib-JSON-LD">JSON-LD</a></cite>] 
earlier in this section can be expressed as HTML+RDFa 
[<cite><a class="bibref" rel="biblioentry" href="#bib-HTML-RDFA">HTML-RDFA</a></cite>]. The rest of this specification will not express information 
using both mechanisms, but will use [<cite><a class="bibref" rel="biblioentry" href="#bib-JSON-LD">JSON-LD</a></cite>] markup for the sake of 
brevity even if the information being expressed is meant to be expressed in
RDFa.
        </p>
        
      </div>

      <div id="publishing-a-license" class="section">
        <h3><span class="secno">7.2 </span>Publishing a License</h3>
        <p>
A <a class="tref internalDFN" title="license" href="#dfn-license">license</a> is a legal description of a licensee's rights to a 
particular <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>.
Licenses are usually included as a part of a <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a> 
to express what a buyer may do with an asset that has been purchased. A license
can include a number of rights bestowed upon the licensesee as well as further
limitations on those rights. For example, how an asset may be
re-broadcast, how often a digital asset may be physically reproduced, what an 
asset may specifically not be used for, and liability limitations when using the 
asset are but a few of the rights and obligations expressible via a license.
        </p>
        
        <p>
The following example describes a very simple license for personal use.
        </p>
        <pre class="example prettyprint language-jsonld">
<span class="pln">{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/licenses/personal-use</span><span class="pln">",
   "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:License</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:format</span><span class="pln">": "</span><span class="str">text/html</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:licenseTemplate</span><span class="pln">": "</span><span class="str">This personal use license allows you to save the 
      purchased asset onto any device that you own for your personal enjoyment
      and make up to &lt;span property=\</span><span class="pln">"ex:physicalCopies\"</span><span class="str"> /&gt; printed
      copies of the work for personal use.</span><span class="pln">"
   "</span><span class="atn jsonld-curie">ps:licenseTerms</span><span class="pln">": 
   {
      "</span><span class="atn jsonld-curie">ex:physicalCopies</span><span class="pln">": </span><span class="lit">5</span><span class="pln">
   }
}
        </span></pre>

        <p class="note">
<a class="tref internalDFN" title="License" href="#dfn-license">License</a>s do not need to be created for each site on the Web. In
many cases, common licenses can be placed on a website and re-used by a large
number of sites that sell assets under similar license terms.
        </p>

      </div>

      <div id="publishing-a-listing" class="section">
        <h3><span class="secno">7.3 </span>Publishing a Listing</h3>

        <p>
A <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> describes the combination of an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> 
that is for sale under a specific <a class="tref internalDFN" title="license" href="#dfn-license">license</a> and a set of payment 
terms that must be fulfilled in order to access the asset. Listings are often 
published on websites that sell assets via PaySwarm as a way to express things
that are for sale, in a decentralized manner.
        </p>

        <p>
The following example describes an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> for sale 
for $0.05 USD under a <a class="tref internalDFN" title="license" href="#dfn-license">license</a>
that covers acceptable use of blog posts. The offer is valid from March 2nd 
2011 to March 3rd 2011. The only restriction on additional payees is that the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> (the organization processing the payment) 
may only take a maximum of 10% of the final sale price to cover their fees.
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#listing</span><span class="pln">",
   "</span><span class="kwd">@type</span><span class="pln">": ["</span><span class="tag jsonld-curie">gr:Offering</span><span class="pln">", "</span><span class="tag jsonld-curie">ps:Listing</span><span class="pln">"],
   "</span><span class="atn jsonld-curie">com:payee</span><span class="pln">": 
   [
      {
         "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#listing-payee</span><span class="pln">",
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:Payee</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/accounts/primary</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:rate</span><span class="pln">": "</span><span class="str">0.05</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:rateType</span><span class="pln">": "</span><span class="tag jsonld-curie">com:FlatAmount</span><span class="pln">",
         "</span><span class="atn jsonld-curie">rdfs:comment</span><span class="pln">": "</span><span class="str">Payment for PaySwarm in Practice by Digital Bazaar.</span><span class="pln">"
      }
   ],
   "</span><span class="atn jsonld-curie">com:payeeRule</span><span class="pln">": 
   [
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:PayeeRule</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:destinationOwnerType</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:Authority</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:maximumRate</span><span class="pln">": "</span><span class="str">10</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:rateType</span><span class="pln">": "</span><span class="tag jsonld-curie">com:InclusivePercentage</span><span class="pln">"
      }
   ],
   "</span><span class="atn jsonld-curie">ps:asset</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#asset</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:assetHash</span><span class="pln">": "</span><span class="str">14618b56ff597a2fed560db9aa0610fe442106a4</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:license</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/licenses/blogging</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:licenseHash</span><span class="pln">": "</span><span class="str">0d8866836917f8ef58af44accb6efab9a10610ad</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">": 
   {
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:JsonLdSignature</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T00:00:00Z</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/keys/4</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">KXtwA5kXZBJzj1rkPMJmGDROjM+fpi2cJIB+Xqf10=</span><span class="pln">"
   },
   "</span><span class="atn jsonld-curie">ps:validFrom</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T00:00:00+0000</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:validUntil</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-03T00:00:00+0000</span><span class="pln">"
}
        </span></pre>

      </div>

      <div id="performing-a-purchase" class="section">
        <h3><span class="secno">7.4 </span>Performing a Purchase</h3>

        <p>
A normal purchase, as opposed to an automatic purchase, is typically performed
via a Web browser-based <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a> when the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>
has never performed a purchase with the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a>'s website. The 
process consists of re-directing the Web browser to the buyer's PaySwarm
Authority for the purposes of authorizing payment to the vendor for a
particular <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>. If a payment authorization is not approved,
the user agent is re-directed back to the vendor's website with an error.
If the payment authorization is approved, the user agent is re-directed bakc to
the vendor's website with a short-form <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a>, which 
is used as a proof-of-purchase for the vendor's listing.
        </p>

        <div id="purchase-terms" class="section">
          <h4><span class="secno">7.4.1 </span>Purchase Terms</h4>
          <p>
There are a number of terms that are used during the course of the purchase
process.
          </p><dl>
            <dt><dfn title="listing_hash" id="dfn-listing_hash">listing hash</dfn></dt>
            <dd>
An identifier created by processing a <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> expressed as
JSON-LD through the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a> and then generating a
SHA-1 hash of the result.
            </dd>
            <dt><dfn title="purchase_callback" id="dfn-purchase_callback">purchase callback</dfn></dt>
            <dd>
An IRI that will be on the receiving end of an HTTP POST from the
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> with the result of a purchase request.
            </dd>
            <dt><dfn title="reference_identifier" id="dfn-reference_identifier">reference identifier</dfn></dt>
            <dd>
A string value that <em class="rfc2119" title="must">must</em> be greater than one character and less than 256
characters used by the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> to track purchases. These 
identifiers can be used to ensure that <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that can be purchased 
multiple times, like game tokens, can be tracked by the vendor.
These identifiers also allow the vendor to protect against unintended
double-purchasing due to network failures.
            </dd>
            <dt><dfn title="receipt" id="dfn-receipt">receipt</dfn></dt>
            <dd>
The resulting value of a purchase request, typically sent from the
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>. The 
object typically contains a <a class="tref" title="short-form_contract">short-form contract</a> as well as 
other information that may be pertinent to the transaction.
            </dd>
          </dl>
          <p></p>
        </div>

        <div id="the-purchase-algorithm" class="section">
        <h4><span class="secno">7.4.2 </span>The Purchase Algorithm</h4>

        <p>
The normative algorithm for performing a purchase is expressed below.
        </p>
        
        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> initiates a purchase request for a specific
listing by re-directing the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a> to the 
<a class="tref internalDFN" title="contracts_service" href="#dfn-contracts_service">contracts service</a> endpoint:
            <ol class="algorithm">
              <li>
Generate the <dfn title="purchase_request_IRI" id="dfn-purchase_request_iri">purchase request IRI</dfn> by concatenating the
<a class="tref internalDFN" title="contracts_service" href="#dfn-contracts_service">contracts service</a> and the following IRI parameters:
                <dl>
                  <dt><code>listing</code></dt>
                  <dd>
The URL-encoded <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> IRI.
                  </dd>
                  <dt><code>listing-hash</code></dt>
                  <dd>
A SHA-1 hash of the listing after being normalized using the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                  </dd>
                  <dt><code>callback</code></dt>
                  <dd>
A de-referenceable IRI that <em class="rfc2119" title="must">must</em> be able to process an HTTP POST request from
the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> with the result of a purchase request.
                  </dd>
                  <dt><code>reference</code></dt>
                  <dd>
An optional, internal reference identifier used by the 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> to keep track of the purchase.
                  </dd>
                  <dt><code>nonce</code></dt>
                  <dd>
An optional cryptographic value that will be used in the encrypted response 
to the vendor. The response nonce is utilized to prevent replay attacks on
the vendor.
                  </dd>
                </dl>
              </li>
              <li>
Perform an HTTP 303 redirect via the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a> to the 
<a class="tref internalDFN" title="purchase_request_IRI" href="#dfn-purchase_request_iri">purchase request IRI</a>.
              </li>
            </ol>
          </li>
          <li>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> processes the purchase request ending in
either an error message or a short-form <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a>:
            <ol class="algorithm">
              <li>
If the purchase was denied or failed for any reason, the authority
performs an HTTP POST via the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a> back to the callback
IRI supplied by the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> during the initiation of the purchase
request.
              </li>
              <li>
If the purchase was successful, then a <a class="tref internalDFN" title="receipt" href="#dfn-receipt-1">receipt</a> is generated and
transmitted to the vendor:
              <ol class="algorithm">
                <li>To generate the <dfn title="receipt" id="dfn-receipt-1">receipt</dfn> in
JSON-LD format, the following pieces of information <em class="rfc2119" title="must">must</em> be expressed:
                <dl>
                  <dt><code>@context</code></dt>
                  <dd>
A single value containing the string <code>http://purl.org/payswarm/v1</code> 
or a list containing that context IRI as the first member, where subsequent 
context declarations <em class="rfc2119" title="must not">must not</em> override any values in the first member.
                  </dd>
                    <dt><code>@type</code></dt>
                    <dd>
The value <code>ps:Receipt</code>.
                    </dd>
                  <dt><code>ps:preference</code></dt>
                  <dd>
An array of preferences that are requested by either the 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> or the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>. All valid options
are listed below:
                    <div>
<code>ps:preAuthorization</code> - The <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> has pre-authorized 
future purchases for the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> and thus the 
<a href="#automatic-purchasing-algorithm">Automatic Purchasing Algorithm</a> 
<em class="rfc2119" title="may">may</em> be used for future purchases. If this preference setting is mentioned, the
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> <em class="rfc2119" title="should">should</em> store the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>'s information,
including the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> IRI, for use in future 
automatic transactions.
                    </div>
                  </dd>
                  <dt><code>ps:contract</code></dt>
The contract used in the receipt is a summary of the digital contract that was
finalized via the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. It includes the minimum
amount of information necessary for the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> to 
correctly identify the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that was transacted:
                  <dd>
                    <dl>
                    <dt><code>@type</code></dt>
                    <dd>
The value <code>ps:Contract</code>.
                    </dd>
                    <dt><code>ps:asset</code></dt>
                    <dd>
An IRI to the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was purchased.
                    </dd>
                    <dt><code>ps:assetHash</code></dt>
                    <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                    </dd>
                    <dt><code>com:reference</code></dt>
                    <dd>
The <a class="tref internalDFN" title="reference_identifier" href="#dfn-reference_identifier">reference identifier</a>, if one was suppied via the purchase 
request.
                    </dd>
                    <dt><code>ps:license</code></dt>
                    <dd>
An IRI to the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> describing the rights associated with the
<a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was purchased.
                    </dd>
                    <dt><code>ps:licenseHash</code></dt>
                    <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                    </dd>
                    <dt><code>ps:listing</code></dt>
                    <dd>
An IRI to the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that was purchased.
                    </dd>
                    <dt><code>ps:listingHash</code></dt>
                    <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                    </dd>
                    <dt><code>ps:assetAcquirer</code></dt>
                    <dd>
An IRI to the <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> that acquired the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>.
                    </dd>
                  </dl>
                </dd></dl>
              </li>
              <li>
The authority initiates an HTTP POST via the 
<a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a> back to the <code>callback</code> IRI supplied by the 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> during the initiation of the purchase request. 
The POST data is digitally signed according to the 
<a href="#request-signature-algorithm">Request Signature Algorithm</a>, 
using the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> of the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
              </li>
            </ol>
          </li>
          <li>
The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> acts upon the callback by granting access
to the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> if the purchase was successful, or providing a page 
detailing why the purchase failed. The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> <em class="rfc2119" title="should">should</em> note 
any preferences in the <a class="tref internalDFN" title="receipt" href="#dfn-receipt-1">receipt</a> and utilize those preferences when
processing future purchases from the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>.
          </li>
        </ol>
        </li></ol></div>
      </div>

      <div id="performing-automatic-purchases" class="section">
        <h3><span class="secno">7.5 </span>Performing Automatic Purchases</h3>

        <p>
An automatic purchase is one where a <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> has been
previously authorized by a <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> to perform purchases with
the buyer's pre-authorized consent. This is typically used when the 
<a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> is trusted, or when the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> has set a 
spending limit with the <a class="tref internalDFN" title="vendor" href="#dfn-vendor">vendor</a> and does not want to be bothered
unless that spending limit is reached. Automatic purchases are designed to 
get out of the way of the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> and make the transactional flow
as friction-free as possible.
        </p>

        <div id="purchase-terms-1" class="section">
          <h4><span class="secno">7.5.1 </span>Purchase Terms</h4>
          <p>
There are a number of terms that are used during the course of the purchase
process.
          </p><dl>
            <dt><dfn title="purchase_request" id="dfn-purchase_request">purchase request</dfn></dt>
            <dd>
A message consisting of a <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> IRI, 
a <a class="tref internalDFN" title="listing_hash" href="#dfn-listing_hash">listing hash</a>, a <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> identity IRI, and
an optional <a class="tref internalDFN" title="reference_identifier" href="#dfn-reference_identifier">reference identifier</a>. The message is typically sent
by a <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> to a <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>'s 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> for processing.
            </dd>
          </dl>
        </div>
        
        <div id="the-automatic-purchase-algorithm" class="section">
        <h4><span class="secno">7.5.2 </span>The Automatic Purchase Algorithm</h4>
        
        <p>
The automatic purchase algorithm is outlined below:
        </p>

        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> prepares a <a class="tref internalDFN" title="purchase_request" href="#dfn-purchase_request">purchase request</a> by
constructing a JSON-LD message. The following pieces of information
<em class="rfc2119" title="must">must</em> be expressed:
            <dl>
              <dt><code>@context</code></dt>
              <dd>
A single value containing the string <code>http://purl.org/payswarm/v1</code> 
or a list containing that context IRI as the first member, where subsequent 
context declarations <em class="rfc2119" title="must not">must not</em> override any values in the first member.
              </dd>
              <dt><code>@type</code></dt>
              <dd>
The value <code>ps:PurchaseRequest</code>.
              </dd>
              <dt><code>ps:listing</code></dt>
              <dd>
An IRI to the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that was purchased.
              </dd>
              <dt><code>ps:listingHash</code></dt>
              <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
              </dd>
              <dt><code>ps:assetAcquirer</code></dt>
              <dd>
An IRI to the <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> that acquired the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>.
              </dd>
              <dt><code>com:reference</code></dt>
              <dd>
The <a class="tref internalDFN" title="reference_identifier" href="#dfn-reference_identifier">reference identifier</a>, if one was suppied via the purchase 
request.
              </dd>
            </dl>
          </li>        
          <li>
The <a class="tref internalDFN" title="purchase_request" href="#dfn-purchase_request">purchase request</a> is digitally signed by the 
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> according to the
<a href="#request-signature-algorithm">Request Signature Algorithm</a> using
the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> associated with the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> in the
<a class="tref internalDFN" title="purchase_request" href="#dfn-purchase_request">purchase request</a>. The <a class="tref internalDFN" title="purchase_request" href="#dfn-purchase_request">purchase request</a> is
sent to the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> of the <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a>
via an HTTPS connection. The HTTPS protocol <em class="rfc2119" title="must">must</em> be used for transmission 
of the request and retrieval of the response to prevent replay attacks.
          </li>
          <li>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> checks to ensure that the
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> is authorized to perform an automatic purchase 
on behalf of the provided <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> identity IRI and responds to the
<a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>:
          <ol class="algorithm">
            <li>
If the transaction fails, the exception details are placed into a JSON-LD 
message and sent to the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>.
              <div class="issue">
Determine how PaySwarm will handle response exceptions.
              </div>
            </li>
            <li>
If the transaction is successful, a <a class="tref internalDFN" title="receipt" href="#dfn-receipt-1">receipt</a> is generated for
the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>. The following fields <em class="rfc2119" title="must">must</em> be
placed into the response:
              <dl>
                <dt><code>@context</code></dt>
                <dd>
A single value containing the string <code>http://purl.org/payswarm/v1</code> 
or a list containing that context IRI as the first member, where subsequent 
context declarations <em class="rfc2119" title="must not">must not</em> override any values in the first member.
                </dd>
                  <dt><code>@type</code></dt>
                  <dd>
The value <code>ps:Receipt</code>.
                  </dd>
                <dt><code>ps:contract</code></dt>
The contract used in the receipt is a summary of the digital contract that was
finalized via the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. It includes the minimum
amount of information necessary for the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> to 
correctly identify the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that was transacted:
                <dd>
                  <dl>
                  <dt><code>@type</code></dt>
                  <dd>
The value <code>ps:Contract</code>.
                  </dd>
                  <dt><code>ps:asset</code></dt>
                  <dd>
An IRI to the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was purchased.
                  </dd>
                  <dt><code>ps:assetHash</code></dt>
                  <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                  </dd>
                  <dt><code>com:reference</code></dt>
                  <dd>
The <a class="tref internalDFN" title="reference_identifier" href="#dfn-reference_identifier">reference identifier</a>, if one was suppied via the purchase 
request.
                  </dd>
                  <dt><code>ps:license</code></dt>
                  <dd>
An IRI to the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> describing the rights associated with the
<a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was purchased.
                  </dd>
                  <dt><code>ps:licenseHash</code></dt>
                  <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                  </dd>
                  <dt><code>ps:listing</code></dt>
                  <dd>
An IRI to the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that was purchased.
                  </dd>
                  <dt><code>ps:listingHash</code></dt>
                  <dd>
The SHA-1 hash of the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> information after being normalized 
using the <a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
                  </dd>
                  <dt><code>ps:assetAcquirer</code></dt>
                  <dd>
An IRI to the <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> that acquired the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a>.
                  </dd>
                </dl>
              </dd></dl>
            </li>
            <li>
The <a class="tref internalDFN" title="receipt" href="#dfn-receipt-1">receipt</a> is encrypted according to the 
<a href="#response-encryption-algorithm">Response Encryption Algorithm</a>, 
using the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> associated with the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>
that digitally signed the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>. The encrypted receipt is
sent to the <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a>.
            </li>
          </ol>
          </li><li>
The <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> receives the response, which will either be
an exception or a receipt, and responds accordingly to the 
<a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>.
          </li>
        </ol>
        </div>
      </div>

      <div id="the-contract" class="section">
        <h3><span class="secno">7.6 </span>The Contract</h3>

        <p>
A <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a> is the result of a commercial transaction in PaySwarm 
and contains information such as the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>, 
the <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> that was purchased, the parties involved in the
transaction, the <a class="tref internalDFN" title="license" href="#dfn-license">license</a> outlining the rights to the 
asset, and payment information associated with the transaction.
        </p>

        <p>
The following example describes a purchase that occurred on March 2nd 2011
for a Web-based article called "PaySwarm in Practice". The article was authored
and listed for sale by Bob Smith and a personal use license was acquired by 
Jane, who may now peruse the article.
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/contracts/28394729347</span><span class="pln">",
   "</span><span class="kwd">@type</span><span class="pln">": ["</span><span class="tag jsonld-curie">ps:Transaction</span><span class="pln">", "</span><span class="tag jsonld-curie">ps:Contract</span><span class="pln">"],
   "</span><span class="atn jsonld-curie">com:amount</span><span class="pln">": "</span><span class="str">0.05</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T03:00:53Z</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:payee</span><span class="pln">": 
   [
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:Payee</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/authority/accounts/main</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:payeePosition</span><span class="pln">": </span><span class="lit">0</span><span class="pln">,
         "</span><span class="atn jsonld-curie">com:rate</span><span class="pln">": "</span><span class="str">10.00</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:rateContext</span><span class="pln">": "</span><span class="tag jsonld-curie">com:TaxExempt</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:rateType</span><span class="pln">": "</span><span class="tag jsonld-curie">com:InclusivePercentage</span><span class="pln">",
         "</span><span class="atn jsonld-curie">rdfs:comment</span><span class="pln">": "</span><span class="str">authority Transaction Processing</span><span class="pln">"
      }
   ],
   "</span><span class="atn jsonld-curie">com:transfer</span><span class="pln">": 
   [
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:Transfer</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:amount</span><span class="pln">": "</span><span class="str">0.045</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/accounts/primary</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:forTransaction</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/contracts/28394729347</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:source</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/jane/accounts/primary</span><span class="pln">",
         "</span><span class="atn jsonld-curie">rdfs:comment</span><span class="pln">": "</span><span class="str">Payment for PaySwarm in Practice by Bob Smith.</span><span class="pln">"
      },
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:Transfer</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:amount</span><span class="pln">": "</span><span class="str">0.005</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/authority/accounts/main</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:forTransaction</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/contracts/28394729347</span><span class="pln">",
         "</span><span class="atn jsonld-curie">com:source</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/jane/accounts/primary</span><span class="pln">",
         "</span><span class="atn jsonld-curie">rdfs:comment</span><span class="pln">": "</span><span class="str">authority Transaction Processing</span><span class="pln">"
      }
   ],
   "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T03:00:53Z</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:asset</span><span class="pln">": 
   {
      "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#asset</span><span class="pln">",
      "</span><span class="kwd">@type</span><span class="pln">": ["</span><span class="tag jsonld-curie">ps:Asset</span><span class="pln">", "</span><span class="tag jsonld-curie">ps:WebPage</span><span class="pln">"],
      "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": 
      {
         "</span><span class="atn jsonld-curie">foaf:name</span><span class="pln">": "</span><span class="str">Bob Smith</span><span class="pln">"
      },
      "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">PaySwarm in Practice</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:assetProvider</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:authority</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/client-config</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:contentUrl</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">": 
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:JsonLdSignature</span><span class="pln">",
         "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T00:00:00Z</span><span class="pln">",
         "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/keys/4</span><span class="pln">",
         "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">XuLEGuq+ne56Qsc5Nic8I=</span><span class="pln">"
      }
   },
   "</span><span class="atn jsonld-curie">ps:assetAcquirer</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/jane</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:assetProviderIdentity</span><span class="pln">": 
   {
      "</span><span class="atn jsonld-curie">ps:identityHash</span><span class="pln">": "</span><span class="str">df913752be56fe0d37dcedc2d7f44708373d2a68</span><span class="pln">"
   },
   "</span><span class="atn jsonld-curie">ps:license</span><span class="pln">": 
   {
      "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/licenses/blogging</span><span class="pln">",
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:License</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:format</span><span class="pln">": "</span><span class="str">text/html</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:licenseTemplate</span><span class="pln">": "</span><span class="str">Personal Use License ...</span><span class="pln">"
   },
   "</span><span class="atn jsonld-curie">ps:listing</span><span class="pln">": 
   {
      "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#listing</span><span class="pln">",
      "</span><span class="kwd">@type</span><span class="pln">": ["</span><span class="tag jsonld-curie">gr:Offering</span><span class="pln">", "</span><span class="tag jsonld-curie">ps:Listing</span><span class="pln">"],
      "</span><span class="atn jsonld-curie">com:payee</span><span class="pln">": 
      [
         {
            "</span><span class="kwd">@id</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#listing-payee</span><span class="pln">",
            "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:Payee</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/accounts/primary</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:rate</span><span class="pln">": "</span><span class="str">0.05</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:rateType</span><span class="pln">": "</span><span class="tag jsonld-curie">com:FlatAmount</span><span class="pln">",
            "</span><span class="atn jsonld-curie">rdfs:comment</span><span class="pln">": "</span><span class="str">Payment for PaySwarm in Practice by Digital Bazaar.</span><span class="pln">"
         }
      ],
      "</span><span class="atn jsonld-curie">com:payeeRule</span><span class="pln">": 
      [
         {
            "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">com:PayeeRule</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:destinationOwnerType</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:Authority</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:maximumRate</span><span class="pln">": "</span><span class="str">10</span><span class="pln">",
            "</span><span class="atn jsonld-curie">com:rateType</span><span class="pln">": "</span><span class="tag jsonld-curie">com:InclusivePercentage</span><span class="pln">"
         }
      ],
      "</span><span class="atn jsonld-curie">ps:asset</span><span class="pln">": "</span><span class="tag jsonld-uri">http://example.com/articles/1#asset</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:assetHash</span><span class="pln">": "</span><span class="str">14618b56ff597a2fed560db9aa0610fe442106a4</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:license</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/licenses/blogging</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:licenseHash</span><span class="pln">": "</span><span class="str">0d8866836917f8ef58af44accb6efab9a10610ad</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">": 
      {
         "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:JsonLdSignature</span><span class="pln">",
         "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T00:00:00Z</span><span class="pln">",
         "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/bob/keys/4</span><span class="pln">",
         "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">KXtwA5kXZBJzj1rkPMJmGDROjM+fpi2cJIB+Xqf10=</span><span class="pln">"
      },
      "</span><span class="atn jsonld-curie">ps:validFrom</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T00:00:00+0000</span><span class="pln">",
      "</span><span class="atn jsonld-curie">ps:validUntil</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-03T00:00:00+0000</span><span class="pln">"
   },
   "</span><span class="atn jsonld-curie">ps:listingHash</span><span class="pln">": "</span><span class="str">1acbd23c3a7d8827270a959a2760f7c4ded98022</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">": 
   {
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:JsonLdSignature</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-03-02T03:00:53Z</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:creator</span><span class="pln">": "</span><span class="tag jsonld-uri">https://payswarm.example.com/i/authority/keys/1</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">ZnGaAs0QCIfEAvCsj2TxRTs8ekQrbbQUXvTLWcQ0kQ==</span><span class="pln">"
   }
}</span></pre>

      </div>

      <div id="verifying-a-purchase" class="section">
        <h3><span class="secno">7.7 </span>Verifying a Purchase</h3>

      </div>
    </div>
    
    <div id="the-decentralized-settlement-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">8. </span>The Decentralized Settlement Process</h2>
      
      <p>
The decentralized settlement process is used to ensure the immediate and 
smooth transition of funds from an account on one 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to an account on another 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
      </p>

      <div id="decentralized-settlement-terms" class="section">
        <h3><span class="secno">8.1 </span>Decentralized Settlement Terms</h3>
        <p>
The following terminology is used to describe concepts used to perform the
settling of accounts between multiple <a class="tref" title="PaySwarm_Authorities">PaySwarm Authorities</a>.
        </p>
        
        <dl>
          <dt><dfn title="disbursing_authority" id="dfn-disbursing_authority">disbursing authority</dfn></dt>
          <dd>
An <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> that is disbursing a set of funds to one or
more receiving <a class="tref internalDFN" title="authority" href="#dfn-authority">PaySwarm authorities</a>.
          </dd>
          <dt><dfn title="receiving_authority" id="dfn-receiving_authority">receiving authority</dfn></dt>
          <dd>
An <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> that is receiving a set of funds from a
<a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a>.
          </dd>
          <dt><dfn title="escrow_transfer_log" id="dfn-escrow_transfer_log">escrow transfer log</dfn></dt>
          <dd>
A log of <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s that are either in the process of being
disbursed or received for a particular particular 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>. The log is used to ensure that double-entries
are not accidentally recorded due to network errors or other fatal errors
associated with hardware or software failures.
          </dd>
        </dl>
      </div>

      <div id="the-decentralized-settlement-algorithm" class="section">
        <h3><span class="secno">8.2 </span>The Decentralized Settlement Algorithm</h3>

        <p>
The following algorithm ensures that funds transferred as a part of a 
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> can be transmitted to one or more 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> payment processors in an interoperable 
fashion such that there are no dangers that the value exchange is lost or
mis-applied to the wrong accounts.
        </p>
        
        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a> contacts each 
<a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a> listed in the list of <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s
contained in the <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> being processed and retrieves the
<code>ps:TransactionBackhaul</code> service from each 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> endpoint. If any
<a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a> is not available now or at any point during
this process, or if the <a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a> is blacklisted for
any reason, the <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> <em class="rfc2119" title="must">must</em> fail.
          </li>
          <li>
The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a> processes <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s
intended for <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s that are local to the system, 
noting outgoing and incoming <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a> amounts in each 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>'s <a class="tref internalDFN" title="escrow_transfer_log" href="#dfn-escrow_transfer_log">escrow transfer log</a>.
          </li>
          <li>
The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a> processes <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s
intended for <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s that are on 
<a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authorities</a>
noting outgoing <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a> amounts in each source
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>'s <a class="tref internalDFN" title="escrow_transfer_log" href="#dfn-escrow_transfer_log">escrow transfer log</a>.
          </li>
          <li>
The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a> transmits the <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>
to each <a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a>. The <a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a>
processes <a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a>s intended for 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s that are on the
<a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authority</a> noting incoming 
<a class="tref internalDFN" title="transfer" href="#dfn-transfer">transfer</a> amounts in each target
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>'s <a class="tref internalDFN" title="escrow_transfer_log" href="#dfn-escrow_transfer_log">escrow transfer log</a>. If all
amounts were not successfully marked in escrow, the <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>
<em class="rfc2119" title="must">must</em> fail.
          </li>
          <li>
The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a> moves all funds from escrow into all
local <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s. The <a class="tref internalDFN" title="disbursing_authority" href="#dfn-disbursing_authority">disbursing authority</a>
contacts all <a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authorities</a> and
instructs them to move all funds from escrow into all destination
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s. This two-stage commit process ensures that
in the event of a failure while contacting multiple 
<a class="tref internalDFN" title="receiving_authority" href="#dfn-receiving_authority">receiving authorities</a>, that 
transactions can be backed out.
            <div class="note">
While this algorithm outlines how transfer records are transmitted and
recorded in a decentralized fashion, it does not outline how each 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> ensures that currencies are exchanged between
financial institutions. One such possibility is an ACH banking transfer, but
such a transfer is not necessary if the banks adopt this protocol for clearing
transactions across financial systems.
            </div>
          </li>
        </ol>
      </div>
    </div>

    <div id="data-portability" class="section">
      
<!-- OddPage -->
<h2><span class="secno">9. </span>Data Portability</h2>
      <p>
One of the freedoms that is ensured by this specification is the freedom to
own your data and move it to an <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> of your choosing. 
That is, your transaction history is your property and therefore you must be 
able to move it to a location of your choosing at will. In order to ensure 
that this freedom is protected, data portability <em class="rfc2119" title="must">must</em> be implemented by 
all conforming implementations of this specification.
      </p>

      <div id="authority-migration" class="section">
        <h3><span class="secno">9.1 </span>Authority Migration</h3>

        <p>
In order to ensure data portability from one <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to 
another <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>, the following objects <em class="rfc2119" title="must">must</em> be transferred:
        </p>

        <ul>
          <li>All <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a></li>
          <li>All <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s</li>
          <li>All <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s</li>
          <li>All <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>s</li>
        </ul>

        <p>
Once the transfer is complete, the new <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> provide the
old <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> with new IRIs for each <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>, 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a> and <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>. The old 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> setup HTTP 301 redirects from the
old IRIs to the new IRIs. Any transaction migrated from the
old <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to the new <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> be honored
and any request to purchase the item again <em class="rfc2119" title="must not">must not</em> result in a debit to any
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>.
        </p>
      </div>

      <div id="authority-migration-terms" class="section">
        <h3><span class="secno">9.2 </span>Authority Migration Terms</h3>
        <p>
The following terminology is used to describe concepts used to transfer all
accounts from an old <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to a new <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>.
        </p>
        
        <dl>
          <dt><dfn title="releasing_authority" id="dfn-releasing_authority">releasing authority</dfn></dt>
          <dd>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> that is the source for all of the data in the
data portability transfer.
          </dd>
          <dt><dfn title="acquiring_authority" id="dfn-acquiring_authority">acquiring authority</dfn></dt>
          <dd>
The <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> that is the destination for all of the data in the
data portability transfer.
          </dd>
          <dt><dfn title="porting_service" id="dfn-porting_service">porting service</dfn></dt>
          <dd>
A Web service that is used to port data from a <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a>
to an <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a>. The service is used to initiate and
finalize the transfer of all <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s, 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s, and
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>s.
          </dd>
          <dt><dfn title="porting_token" id="dfn-porting_token">porting token</dfn></dt>
          <dd>
A random string that must be at least 32 bytes long and no less than 
128 bytes long. It serves as a temporary value that must be copied 
from the <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> to the 
<a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> for two reasons; 1) as a security measure 
against automatic transferral of financial data and 2) as a temporary value 
that is used to denote all identities being transferred as a part of the
migration process.
          </dd>
        </dl>
      </div>

      <div id="the-authority-migration-algorithm" class="section">
        <h3><span class="secno">9.3 </span>The Authority Migration Algorithm</h3>

        <p>
The following algorithm ensures that all <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s, 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s, and
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>s are moved from a <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a>
to an <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> such that a person or organization may
start using the <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> as their primary 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> without any major interruption in service. The algorithm
is initiated when an <a class="tref internalDFN" title="agent" href="#dfn-agent">agent</a> marks their account on a
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> for migration. A random <a class="tref internalDFN" title="porting_token" href="#dfn-porting_token">porting token</a> <em class="rfc2119" title="must">must</em> 
be created and displayed to the person or organization performing the port.
A flag on all associated <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, 
<em class="rfc2119" title="must">must</em> be set to <strong>MIGRATION_STARTED</strong>.
        </p>
        
        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> utilizes the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> of the <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> to
discover the <a class="tref internalDFN" title="porting_service" href="#dfn-porting_service">porting service</a> IRI.
          </li>
          <li>
The <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> performs an HTTPS GET request
to the <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a>'s <a class="tref internalDFN" title="porting_service" href="#dfn-porting_service">porting service</a>. The
URL <em class="rfc2119" title="must">must</em> include the <a class="tref internalDFN" title="porting_token" href="#dfn-porting_token">porting token</a> as a query parameter with
the name <code>token</code>.
          </li>
          <li>
The <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> <em class="rfc2119" title="must">must</em> set a flag on all associated
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a> to
<strong>MIGRATION_IN_PROGRESS</strong>. All <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>s 
involving the previsouly flagged <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>
<em class="rfc2119" title="must">must</em> be denied while the <strong>MIGRATION_IN_PROGRESS</strong> flag is active.
          </li>
          <li>
The <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> builds a JSON-LD object containing
a list of <code>@id</code> values for all 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s,
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s, and <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>s, in that order. For
each object, it <em class="rfc2119" title="must">must</em> contain at least the following properties:
            <dl style="margin-left: 1em;">
              <dt><code>ps:Identity</code></dt><dt>
              </dt><dd>
<code>@id</code>, <code>@type</code>, <code>foaf:name</code>, 
<code>rdfs:label</code>, <code>vcard:adr</code>
              </dd>
              <dt><code>com:Account</code></dt><dt>
              </dt><dd>
<code>@id</code>, <code>@type</code>, <code>rdfs:label</code>, 
<code>rdfs:comment</code>,
<code>com:amount</code>, <code>com:currency</code>, <code>ps:owner</code>
              </dd>
              <dt><code>sec:Key</code></dt><dt>
              </dt><dd>
<code>@id</code>, <code>@type</code>, <code>rdfs:label</code>, 
<code>rdfs:comment</code>, <code>sec:publicKeyPem</code>, 
<code>ps:owner</code>
              </dd>
              <dt><code>ps:Transaction</code></dt><dt>
              </dt><dd>
The entire object on record.
              </dd>
            </dl>
            <div class="issue">
This section needs to show examples of exactly what the array and details 
should look like.
            </div>
          </li>
          <li>
The <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a> processes the array generated in the
previous step and creates new IRIs for all 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s, and
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s. Each <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identity</a>, 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>, and <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> object is
collected into an array and HTTPS POSTed back to the 
<a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> with a new property 
(<code>rdfs:seeAlso</code>) set to the newly generate IRI for the object.
The URL <em class="rfc2119" title="must">must</em> include the <a class="tref internalDFN" title="porting_token" href="#dfn-porting_token">porting token</a> as a query parameter with
the name <code>token</code>.
          </li>
          <li>
A <a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> <em class="rfc2119" title="must">must</em> be performed from the 
<a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> to the <a class="tref internalDFN" title="acquiring_authority" href="#dfn-acquiring_authority">acquiring authority</a>
transferring all remaining funds from all the old 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s to all of the new 
<a class="tref" title="financial_accounts">financial accounts</a>.
          </li>
          <li>
The <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> <em class="rfc2119" title="must">must</em> use the <code>rdfs:seeAlso</code>
value to setup HTTP 301 response codes for all migrated 
<a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a>, <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s, and
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>s. At this point, any transactions that would result
in the old IRIs being used <em class="rfc2119" title="must">must</em> fail. The <a class="tref internalDFN" title="releasing_authority" href="#dfn-releasing_authority">releasing authority</a> 
<em class="rfc2119" title="must">must</em> set a flag on all associated <a class="tref internalDFN" title="identity" href="#dfn-identity-1">identities</a> to
<strong>MIGRATION_COMPLETE</strong>.
          </li>
        </ol>
      </div>
    </div>

    <div id="the-transaction-intent-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">10. </span>The Transaction Intent Process</h2>

      <p>
A <dfn title="transaction_intent" id="dfn-transaction_intent">transaction intent</dfn> is the agreement to execute a 
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a> once a pre-defined set of external parameters have been
met. The most direct example of this is when a group of funders promises to 
fund a project if the project can raise a minimum amount of capital by a 
certain date.
      </p>

      <div id="transaction-intent-terms" class="section">
        <h3><span class="secno">10.1 </span>Transaction Intent Terms</h3>
        <p>
The following terminology is used to describe concepts used when processing
<a class="tref internalDFN" title="transaction_intent" href="#dfn-transaction_intent">transaction intent</a>s.
        </p>
        
        <dl>
          <dt><dfn title="promisor" id="dfn-promisor">promisor</dfn></dt>
          <dd>
A <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> that has created a parameterized 
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> that will result in a 
<a class="tref internalDFN" title="transaction_intent" href="#dfn-transaction_intent">transaction intent</a> if transacted.
          </dd>
          <dt><dfn title="promisee" id="dfn-promisee">promisee</dfn></dt>
          <dd>
A <a class="tref internalDFN" title="participant" href="#dfn-participant">participant</a> that is making a promise to enter into a 
<a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a> if the terms of the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>
are met before a certain date and time.
          </dd>
        </dl>
      </div>

      <div id="the-transaction-intent-algorithm" class="section">
        <h3><span class="secno">10.2 </span>The Transaction Intent Algorithm</h3>

        <p>
The following algorithm describes the <a class="tref internalDFN" title="transaction_intent" href="#dfn-transaction_intent">transaction intent</a> process,
which consists of three distinct phases. The first phase is the publication of
the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> by the <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>. The 
second phase is the submission of transaction intents from 
<a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>s. The third phase is the finalization of transaction 
intents into <a class="tref internalDFN" title="contract" href="#dfn-contract">contract</a>s.
        </p>

        <p class="issue">
This section still needs a ton of work: specify the JSON-LD messages that are 
transmitted in detail, examples, and cover error conditions and
exceptions.
        </p>

        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a> creates an <a class="tref internalDFN" title="asset" href="#dfn-asset">asset</a> describing the asset
provided if the parameters in the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> are met.
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a> also creates a parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>
containing at least the following two fields:
            <dl>
              <dt><code>ps:constraint</code></dt>
              <dd>
A set of parameters that must be met in order to complete the 
<a class="tref internalDFN" title="transaction" href="#dfn-transaction">transaction</a>.
                <dl>
                  <dt><code>com:minimumAmount</code></dt>
                  <dd>
The minimum amount necessary, in aggregate, to finalize all transaction intents
before the deadline.
                  </dd>
                  <dt><code>com:currency</code></dt>
                  <dd>
The currency associated with the minimum amount field.
                  </dd>
                </dl>
              </dd>
            </dl>
          </li>
          <li>
When an <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> processes the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>,
per <a href="#the-purchase-algorithm">The Purchase Algorithm</a>, a 
<code>ps:Contract</code> and <code>ps:Receipt</code> are generated as 
specified in the algorithm, but funds <em class="rfc2119" title="must not">must not</em> be disbursed at that time. 
Instead of the <code>ps:Receipt</code>'s <code>ps:contract</code>'s property 
being of <code>@type</code> <code>ps:Contract</code>, it <em class="rfc2119" title="must">must</em> instead be of type 
<code>ps:TransactionIntent</code>. All other fields must remain the same both
in the short-form contract and the long-form contract. 
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="publishing_agent" href="#dfn-publishing_agent">publishing agent</a> is notified of the
intent in the same way as it would be notified of a purchase except that the
resulting receipt will be the modified object as described in this step.
          </li>
          <li>
The <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> then notifies the 
<a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> of the transaction intent by
retrieving the <a class="tref internalDFN" title="transaction_service" href="#dfn-transaction_service">transaction service</a> IRI from the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a>. The <code>ps:TransactionIntent</code> is
sent to the <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> via an HTTPS POST.
          </li>
          <li>
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> keeps track of all
<code>ps:TransactionIntent</code>'s for the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a>
until the end of the <code>ps:validUntil</code> date in the 
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> or until the <code>com:minimumAmount</code> in the
<code>ps:constraint</code> property in the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> has been met 
in aggregate.
          </li>
          <li>
If the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> detects that the <code>com:minimumAmount</code> 
in the <code>ps:constraint</code> property in the <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> 
has been met in aggregate, it submits all <code>ps:TransactionIntent</code>s 
for the parameterized <a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> to each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a>. That is, for every <code>com:source</code> 
<a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a> intended to transfer money to the 
<code>com:destination</code> in each <code>ps:TransactionIntent</code>s, the
source <a class="tref internalDFN" title="financial_account" href="#dfn-financial_account-1">financial account</a>s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> is contacted.
          </li>
          <li>
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> determine if all
<a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s can meet their obligation. It does 
so by contacting each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> and
performing an HTTP POST of all <code>ps:TransactionIntent</code>s intended
for the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to the <a class="tref internalDFN" title="transaction_service" href="#dfn-transaction_service">transaction service</a> with
an additional query parameter where the key is <code>mode</code> and the
value is <code>query</code>. Each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> responds with a total amount of funds that are available
to be committed.
          </li>
          <li>
If the previous step is successful and there are enough funds to meet the
<a class="tref" title="com:minimumAmount">com:minimumAmount</a> constraint, then the 
<a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> then place all amounts
listed in all <code>ps:TransactionIntent</code> on hold. It does 
this by contacting each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> by
performing an HTTP POST of all <code>ps:TransactionIntent</code>'s intended
for the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to the <a class="tref internalDFN" title="transaction_service" href="#dfn-transaction_service">transaction service</a> with
an additional query parameter where the key is <code>mode</code> and the
value is <code>hold</code>. Each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> responds with a total amount of funds placed on hold. 
          </li>
          <li>
If the previous step is successful and enough funds were placed on hold
to meet the <a class="tref" title="com:minimumAmount">com:minimumAmount</a> constraint, then the 
<a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> <em class="rfc2119" title="must">must</em> then retrieve all amounts
listed in all <code>ps:TransactionIntent</code>s. It does 
this by contacting each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> by
performing an HTTP POST of all <code>ps:TransactionIntent</code>'s intended
for the <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> to the <a class="tref internalDFN" title="transaction_service" href="#dfn-transaction_service">transaction service</a> with
an additional query parameter where the key is <code>mode</code> and the
value is <code>finalize</code>. Each <a class="tref internalDFN" title="promisee" href="#dfn-promisee">promisee</a>'s 
<a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> responds with a finalized contract for each
<code>ps:TransactionIntent</code> and disburses the funds according to the
<a href="#the-decentralized-settlement-algorithm">Decentralized Settlement Algorithm</a>.
          </li>
          <li>
The <a class="tref internalDFN" title="promisor" href="#dfn-promisor">promisor</a>'s <a class="tref internalDFN" title="authority" href="#dfn-authority">authority</a> marks the parameterized
<a class="tref internalDFN" title="listing" href="#dfn-listing">listing</a> as being fulfilled and any further 
<code>ps:TransactionIntent</code>s submitted before the 
<code>ps:validUntil</code> date are automatically processed according to the
previous step.
          </li>
        </ol>
        
      </div>

    </div>


    <div id="the-payswarm-api" class="section">
      
<!-- OddPage -->
<h2><span class="secno">11. </span>The PaySwarm API</h2>
    </div>

    <div id="implementation-details" class="section">
      
<!-- OddPage -->
<h2><span class="secno">12. </span>Implementation Details</h2>

      <div id="digital-signatures" class="section">
        <h3><span class="secno">12.1 </span>Digital Signatures</h3>

        <div id="signing" class="section">
          <h4><span class="secno">12.1.1 </span>Signing</h4>

        </div>

        <div id="verifying" class="section">
          <h4><span class="secno">12.1.2 </span>Verifying</h4>

        </div>
      </div>
    </div>

    <div id="security-concerns" class="section">
      
<!-- OddPage -->
<h2><span class="secno">13. </span>Security Concerns</h2>
      <p>
      </p>

      <div id="identity-management" class="section">
        <h3><span class="secno">13.1 </span>Identity Management</h3>
        <p>
        </p>
      </div>

      <div id="digital-signatures-1" class="section">
        <h3><span class="secno">13.2 </span>Digital Signatures</h3>
        <p>
        </p>
      </div>

      <div id="identifying-and-removing-troublemakers" class="section">
        <h3><span class="secno">13.3 </span>Identifying and Removing Troublemakers</h3>
        <p>
        </p>
      </div>

      <div id="halting-asset-distribution" class="section">
        <h3><span class="secno">13.4 </span>Halting Asset Distribution</h3>
        <p>
        </p>
      </div>
    </div>

   


<div id="references" class="appendix section">
<!-- OddPage -->
<h2><span class="secno">A. </span>References</h2><div id="normative-references" class="section"><h3><span class="secno">A.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-FIPS-197">[FIPS-197]</dt><dd>Information Technology Laboratory. <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf"><cite>Specification for the ADVANCED ENCRYPTION STANDARD (AES)</cite></a> November 26th, 2001. Department of Commerce, National Institute of Standards and Technology. URL: <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf</a>
</dd><dt id="bib-HTML-RDFA">[HTML-RDFA]</dt><dd>Manu Sporny; et al. <a href="http://www.w3.org/TR/rdfa-in-html/"><cite>HTML+RDFa</cite></a> 04 March 2010. W3C Working Draft. URL: <a href="http://www.w3.org/TR/rdfa-in-html/">http://www.w3.org/TR/rdfa-in-html/</a> 
</dd><dt id="bib-IRI">[IRI]</dt><dd>M. Duerst, M. Suignard. <a href="http://www.ietf.org/rfc/rfc3987.txt"><cite>Internationalized Resource Identifiers (IRI).</cite></a> January 2005. Internet RFC 3987. URL: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3987.txt</a> 
</dd><dt id="bib-JSON-LD">[JSON-LD]</dt><dd>Manu Sporny; Gregg Kellogg; Dave Longley; et al. <a href="http://json-ld.org/spec/latest/"><cite>JSON-LD</cite></a> latest. W3C Community Group Working Draft. URL: <a href="http://json-ld.org/spec/latest/">http://json-ld.org/spec/latest/</a> 
</dd><dt id="bib-RDFA-CORE">[RDFA-CORE]</dt><dd>Shane McCarron; et al. <a href="http://www.w3.org/TR/2011/WD-rdfa-core-20110331"><cite>RDFa Core 1.1: Syntax and processing rules for embedding RDF through attributes.</cite></a> 31 March 2011. W3C Working Draft. URL: <a href="http://www.w3.org/TR/2011/WD-rdfa-core-20110331">http://www.w3.org/TR/2011/WD-rdfa-core-20110331</a> 
</dd></dl></div><div id="informative-references" class="section"><h3><span class="secno">A.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-AES">[AES]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf"><cite>NIST FIPS 197: Advanced Encryption Standard (AES)</cite></a>. November 2001. URL: <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf</a>
</dd><dt id="bib-REST">[REST]</dt><dd>Fielding, Roy Thomas. <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/"><cite>Architectural Styles and the Design of Network-based Software Architectures</cite></a> 2000. University of California, Irvine. URL: <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/">http://www.ics.uci.edu/~fielding/pubs/dissertation/</a>
</dd></dl></div></div></body></html>
