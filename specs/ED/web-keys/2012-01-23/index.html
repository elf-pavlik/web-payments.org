<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">
<head> 
    <title>Web Keys 1.0</title> 
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> 
    
<!--  
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
      -->
 
     
     
    
    
    
  <style type="text/css">
/*****************************************************************
 * ReSpec CSS
 * Robin Berjon (robin at berjon dot com)
 * v0.05 - 2009-07-31
 *****************************************************************/


/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

code {
    color:  #ff4500;
}


/* --- WEB IDL --- */
pre.idl {
    border-top: 1px solid #90b8de;
    border-bottom: 1px solid #90b8de;
    padding:    1em;
    line-height:    120%;
}

pre.idl::before {
    content:    "WebIDL";
    display:    block;
    width:      150px;
    background: #90b8de;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

.idlType {
    color:  #ff4500;
    font-weight:    bold;
    text-decoration:    none;
}

/*.idlModule*/
/*.idlModuleID*/
/*.idlInterface*/
.idlInterfaceID, .idlDictionaryID {
    font-weight:    bold;
    color:  #005a9c;
}

.idlSuperclass {
    font-style: italic;
    color:  #005a9c;
}

/*.idlAttribute*/
.idlAttrType, .idlFieldType, .idlMemberType {
    color:  #005a9c;
}
.idlAttrName, .idlFieldName, .idlMemberName {
    color:  #ff4500;
}
.idlAttrName a, .idlFieldName a, .idlMemberName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlMethod*/
.idlMethType {
    color:  #005a9c;
}
.idlMethName {
    color:  #ff4500;
}
.idlMethName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlParam*/
.idlParamType {
    color:  #005a9c;
}
.idlParamName {
    font-style: italic;
}

.extAttr {
    color:  #666;
}

/*.idlConst*/
.idlConstType {
    color:  #005a9c;
}
.idlConstName {
    color:  #ff4500;
}
.idlConstName a {
    color:  #ff4500;
    border-bottom:  1px dotted #ff4500;
    text-decoration: none;
}

/*.idlException*/
.idlExceptionID {
    font-weight:    bold;
    color:  #c00;
}

.idlTypedefID, .idlTypedefType {
    color:  #005a9c;
}

.idlRaises, .idlRaises a.idlType, .idlRaises a.idlType code, .excName a, .excName a code {
    color:  #c00;
    font-weight:    normal;
}

.excName a {
    font-family:    monospace;
}

.idlRaises a.idlType, .excName a.idlType {
    border-bottom:  1px dotted #c00;
}

.excGetSetTrue, .excGetSetFalse, .prmNullTrue, .prmNullFalse, .prmOptTrue, .prmOptFalse {
    width:  45px;
    text-align: center;
}
.excGetSetTrue, .prmNullTrue, .prmOptTrue { color:  #0c0; }
.excGetSetFalse, .prmNullFalse, .prmOptFalse { color:  #c00; }

.idlImplements a {
    font-weight:    bold;
}

dl.attributes, dl.methods, dl.constants, dl.fields, dl.dictionary-members {
    margin-left:    2em;
}

.attributes dt, .methods dt, .constants dt, .fields dt, .dictionary-members dt {
    font-weight:    normal;
}

.attributes dt code, .methods dt code, .constants dt code, .fields dt code, .dictionary-members dt code {
    font-weight:    bold;
    color:  #000;
    font-family:    monospace;
}

.attributes dt code, .fields dt code, .dictionary-members dt code {
    background:  #ffffd2;
}

.attributes dt .idlAttrType code, .fields dt .idlFieldType code, .dictionary-members dt .idlMemberType code {
    color:  #005a9c;
    background:  transparent;
    font-family:    inherit;
    font-weight:    normal;
    font-style: italic;
}

.methods dt code {
    background:  #d9e6f8;
}

.constants dt code {
    background:  #ddffd2;
}

.attributes dd, .methods dd, .constants dd, .fields dd, .dictionary-members dd {
    margin-bottom:  1em;
}

table.parameters, table.exceptions {
    border-spacing: 0;
    border-collapse:    collapse;
    margin: 0.5em 0;
    width:  100%;
}
table.parameters { border-bottom:  1px solid #90b8de; }
table.exceptions { border-bottom:  1px solid #deb890; }

.parameters th, .exceptions th {
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
    font-family:    initial;
    font-weight:    normal;
    text-shadow:    #666 1px 1px 0;
}
.parameters th { background: #90b8de; }
.exceptions th { background: #deb890; }

.parameters td, .exceptions td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
    vertical-align: top;
}

.parameters tr:first-child td, .exceptions tr:first-child td {
    border-top: none;
}

.parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
    width:  100px;
}

.parameters td.prmType {
    width:  120px;
}

table.exceptions table {
    border-spacing: 0;
    border-collapse:    collapse;
    width:  100%;
}

/* --- TOC --- */
.toc a {
    text-decoration:    none;
}

a .secno {
    color:  #000;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

/* --- EXAMPLES --- */
pre.example {
    border-top: 1px solid #ff4500;
    border-bottom: 1px solid #ff4500;
    padding:    1em;
    margin-top: 1em;
}

pre.example::before {
    content:    "Example";
    display:    block;
    width:      150px;
    background: #ff4500;
    color:  #fff;
    font-family:    initial;
    padding:    3px;
    font-weight:    bold;
    margin: -1em 0 1em -1em;
}

/* --- EDITORIAL NOTES --- */
.issue {
    padding:    1em;
    margin: 1em 0em 0em;
    border: 1px solid #f00;
    background: #ffc;
}

.issue::before {
    content:    "Issue";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #f00;
    background: #fff;
    padding:    3px 1em;
}

.note {
    margin: 1em 0em 0em;
    padding:    1em;
    border: 2px solid #cff6d9;
    background: #e2fff0;
}

.note::before {
    content:    "Note";
    display:    block;
    width:  150px;
    margin: -1.5em 0 0.5em 0;
    font-weight:    bold;
    border: 1px solid #cff6d9;
    background: #fff;
    padding:    3px 1em;
}

/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
}

span.practicelab   { background: #dfffff; }

span.practicelab {
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}

/* --- SYNTAX HIGHLIGHTING --- */
pre.sh_sourceCode {
  background-color: white;
  color: black;
  font-style: normal;
  font-weight: normal;
}

pre.sh_sourceCode .sh_keyword { color: #005a9c; font-weight: bold; }           /* language keywords */
pre.sh_sourceCode .sh_type { color: #666; }                            /* basic types */
pre.sh_sourceCode .sh_usertype { color: teal; }                             /* user defined types */
pre.sh_sourceCode .sh_string { color: red; font-family: monospace; }        /* strings and chars */
pre.sh_sourceCode .sh_regexp { color: orange; font-family: monospace; }     /* regular expressions */
pre.sh_sourceCode .sh_specialchar { color: 	#ffc0cb; font-family: monospace; }  /* e.g., \n, \t, \\ */
pre.sh_sourceCode .sh_comment { color: #A52A2A; font-style: italic; }         /* comments */
pre.sh_sourceCode .sh_number { color: purple; }                             /* literal numbers */
pre.sh_sourceCode .sh_preproc { color: #00008B; font-weight: bold; }       /* e.g., #include, import */
pre.sh_sourceCode .sh_symbol { color: blue; }                            /* e.g., *, + */
pre.sh_sourceCode .sh_function { color: black; font-weight: bold; }         /* function calls and declarations */
pre.sh_sourceCode .sh_cbracket { color: red; }                              /* block brackets (e.g., {, }) */
pre.sh_sourceCode .sh_todo { font-weight: bold; background-color: #00FFFF; }   /* TODO and FIXME */

/* Predefined variables and functions (for instance glsl) */
pre.sh_sourceCode .sh_predef_var { color: #00008B; }
pre.sh_sourceCode .sh_predef_func { color: #00008B; font-weight: bold; }

/* for OOP */
pre.sh_sourceCode .sh_classname { color: teal; }

/* line numbers (not yet implemented) */
pre.sh_sourceCode .sh_linenum { display: none; }

/* Internet related */
pre.sh_sourceCode .sh_url { color: blue; text-decoration: underline; font-family: monospace; }

/* for ChangeLog and Log files */
pre.sh_sourceCode .sh_date { color: blue; font-weight: bold; }
pre.sh_sourceCode .sh_time, pre.sh_sourceCode .sh_file { color: #00008B; font-weight: bold; }
pre.sh_sourceCode .sh_ip, pre.sh_sourceCode .sh_name { color: #006400; }

/* for Prolog, Perl... */
pre.sh_sourceCode .sh_variable { color: #006400; }

/* for LaTeX */
pre.sh_sourceCode .sh_italics { color: #006400; font-style: italic; }
pre.sh_sourceCode .sh_bold { color: #006400; font-weight: bold; }
pre.sh_sourceCode .sh_underline { color: #006400; text-decoration: underline; }
pre.sh_sourceCode .sh_fixed { color: green; font-family: monospace; }
pre.sh_sourceCode .sh_argument { color: #006400; }
pre.sh_sourceCode .sh_optionalargument { color: purple; }
pre.sh_sourceCode .sh_math { color: orange; }
pre.sh_sourceCode .sh_bibtex { color: blue; }

/* for diffs */
pre.sh_sourceCode .sh_oldfile { color: orange; }
pre.sh_sourceCode .sh_newfile { color: #006400; }
pre.sh_sourceCode .sh_difflines { color: blue; }

/* for css */
pre.sh_sourceCode .sh_selector { color: purple; }
pre.sh_sourceCode .sh_property { color: blue; }
pre.sh_sourceCode .sh_value { color: #006400; font-style: italic; }

/* other */
pre.sh_sourceCode .sh_section { color: black; font-weight: bold; }
pre.sh_sourceCode .sh_paren { color: red; }
pre.sh_sourceCode .sh_attribute { color: #006400; }

</style><style type="text/css">ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }

</style><style type="text/css">/*
 * Derived from einaros's Sons of Obsidian theme at
 * http://studiostyl.es/schemes/son-of-obsidian by
 * and Alex Ford of CodeTunnel
 * http://CodeTunnel.com/blog/post/71/google-code-prettify-obsidian-theme
 */

.str
{
    color: #93C763;
}
.kwd
{
    color: #EC7600;
}
.com
{
    color: #66747B;
}
.typ
{
    color: #678CB1;
}
.lit
{
    color: #FACD22;
}
.pun
{
    color: #F1F2F3;
}
.pln
{
    color: #F1F2F3;
}
.tag
{
    color: #8AC763;
}
.tag.jsonld-uri
{
    color: #8A93CD;
}
.tag.turtle-uri
{
    color: #8A93CD;
}
.tag.turtle-curie
{
    color: #AC84CB;
}
.atn
{
    color: #E0E2E4;
}
.atn.jsonld-curie
{
    color: #AC84CB;
}
.atn.turtle-curie
{
    color: #FACD22;
}
.atv
{
    color: #EC7600;
}
.dec
{
    color: purple;
}
pre.prettyprint
{
    border: 0px solid #888;
}
ol.linenums
{
    margin-top: 0;
    margin-bottom: 0;
}

.prettyprint {
    font: monospace;
    /*font-size: 0.8em;*/
    font-weight: bold;
    background: #000;
    color: #ddd;
    /*overflow: auto;*/
}
li.L0, li.L1, li.L2, li.L3, li.L4, li.L5, li.L6, li.L7, li.L8, li.L9
{
    color: #555;
}
li.L1, li.L3, li.L5, li.L7, li.L9 {
    background: #111;
}
@media print
{
    .str
    {
        color: #060;
    }
    .kwd
    {
        color: #006;
        font-weight: bold;
    }
    .com
    {
        color: #600;
        font-style: italic;
    }
    .typ
    {
        color: #404;
        font-weight: bold;
    }
    .lit
    {
        color: #044;
    }
    .pun
    {
        color: #440;
    }
    .pln
    {
        color: #000;
    }
    .tag
    {
        color: #006;
        font-weight: bold;
    }
    .atn
    {
        color: #404;
    }
    .atv
    {
        color: #060;
    }
}
</style><link href="//www.w3.org/StyleSheets/TR/w3c-unofficial" rel="stylesheet" type="text/css" charset="utf-8" /></head> 
  <body style="display: inherit; "><div class="head"><p></p><h1 class="title" id="title">Web Keys 1.0</h1><h2 id="unofficial-draft-24-january-2012">Unofficial Draft 24 January 2012</h2><dl><dt>Editor:</dt><dd><a href="http://digitalbazaar.com/">Manu Sporny</a>, <a href="http://digitalbazaar.com/">Digital Bazaar, Inc.</a></dd>
</dl><p class="copyright">Copyright 2009-2011 © Digital Bazaar, Inc.</p><hr /></div> 
    <div id="abstract" class="introductory section"><h2>Abstract</h2> 
      <p>
The future of messaging in Web services depends on three key
features; message verifiability, secure messaging, and dynamic access 
control to resources. While OAuth provides a mechanism for performing dynamic
access control to resources, it does not address verifiability and secure
messaging. More advanced Web service systems are being built now that
require all three features. Historically, public/private key cryptography 
has provided a mechanism to achieve message verifiability 
(via digital signatures), and secure messaging (via encryption). Often,
access control to resources are built on top of public/private key
cryptography systems. The challenge has always been in building an extensible,
distributed, Public Key Infrastructure for the Web. This specification 
demonstrates how systems that require more than OAuth 2 can hook into a 
decentralized Public Key Infrastructure that is built on top of the Web 
using Linked Data principles.
      </p>
    </div><div id="sotd" class="introductory section"><h2>Status of This Document</h2><p>This document is merely a public working draft of a potential specification. It has no official standing of any kind and does not represent the support or consensus of any standards organisation.</p></div><div id="toc" class="section"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#introduction" class="tocxref"><span class="secno">1. </span>Introduction</a><ul class="toc"><li class="tocline"><a href="#key-technologies" class="tocxref"><span class="secno">1.1 </span>Key Technologies</a></li></ul></li><li class="tocline"><a href="#the-key-registration-process" class="tocxref"><span class="secno">2. </span>The Key Registration Process</a><ul class="toc"><li class="tocline"><a href="#key-registration-terms" class="tocxref"><span class="secno">2.1 </span>Key Registration Terms</a></li><li class="tocline"><a href="#key-owner-registration" class="tocxref"><span class="secno">2.2 </span>Key Owner Registration</a></li><li class="tocline"><a href="#web-key-registration" class="tocxref"><span class="secno">2.3 </span>Web Key Registration</a></li><li class="tocline"><a href="#security-concerns-for-registration" class="tocxref"><span class="secno">2.4 </span>Security Concerns for Registration</a></li></ul></li><li class="tocline"><a href="#discovery" class="tocxref"><span class="secno">3. </span>Discovery</a></li><li class="tocline"><a href="#messaging" class="tocxref"><span class="secno">4. </span>Messaging</a><ul class="toc"><li class="tocline"><a href="#messaging-terms" class="tocxref"><span class="secno">4.1 </span>Messaging Terms</a></li><li class="tocline"><a href="#message-signature-algorithm" class="tocxref"><span class="secno">4.2 </span>Message Signature Algorithm</a></li><li class="tocline"><a href="#message-signature-verification-algorithm" class="tocxref"><span class="secno">4.3 </span>Message Signature Verification Algorithm</a></li><li class="tocline"><a href="#message-encryption-algorithm" class="tocxref"><span class="secno">4.4 </span>Message Encryption Algorithm</a></li><li class="tocline"><a href="#message-decryption-algorithm" class="tocxref"><span class="secno">4.5 </span>Message Decryption Algorithm</a></li><li class="tocline"><a href="#security-considerations" class="tocxref"><span class="secno">4.6 </span>Security Considerations</a><ul class="toc"><li class="tocline"><a href="#the-response-token" class="tocxref"><span class="secno">4.6.1 </span>The Response Token</a></li></ul></li></ul></li><li class="tocline"><a href="#permission-and-access-rights-delegation" class="tocxref"><span class="secno">5. </span>Permission and Access Rights Delegation</a></li><li class="tocline"><a href="#key-revocation-and-expiration" class="tocxref"><span class="secno">6. </span>Key Revocation and Expiration</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">A. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">A.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">A.2 </span>Informative references</a></li></ul></li></ul></div>

    <div id="introduction" class="section">
      
<!-- OddPage -->
<h2><span class="secno">1. </span>Introduction</h2>
      <p class="issue">
Need to write an introductory section.
      </p>
      <p class="note">
Web Keys are not a replacement for Transport Layer Security, but are designed 
to work in concert with the security protocol. Web Keys are also capable of 
operating in environments where TLS is not available to the application.
      </p>
      <div id="key-technologies" class="section">
         <h3><span class="secno">1.1 </span>Key Technologies</h3>
         <p>
Technologies utilized in this specification include the
JavaScript Object Notation for Linking Data [<cite><a class="bibref" rel="biblioentry" href="#bib-JSON-LD">JSON-LD</a></cite>], and the
Advanced Encryption Standard [<cite><a class="bibref" rel="biblioentry" href="#bib-AES">AES</a></cite>].
         </p><p>
      </p></div>

    </div>

    <div id="the-key-registration-process" class="section">
      
<!-- OddPage -->
<h2><span class="secno">2. </span>The Key Registration Process</h2>
      <p>
The registration process is necessary in order to publish a public key at
a location on the Web.
      </p>

      <div id="key-registration-terms" class="section">
        <h3><span class="secno">2.1 </span>Key Registration Terms</h3>
        <p>
There are a number of terms that are used during the course of the registration
process.
        </p><dl>
        <dt><dfn title="actor" id="dfn-actor">actor</dfn></dt>
        <dd>An entity, such as a person or organization, that performs actions
on the Internet.</dd>
        <dt><dfn title="account" id="dfn-account">account</dfn></dt>
        <dd>An identifier with a set of log in credentials that is associated
with a <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>.</dd>
        <dt><dfn title="user_agent" id="dfn-user_agent">user agent</dfn></dt>
        <dd>The piece of software operating on behalf of the 
<a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a>. This is typically a Web Browser, but could be
some other piece of Web-aware automated software acting on behalf of an
<a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a>.</dd>
        <dt><dfn title="key_agent" id="dfn-key_agent">key agent</dfn></dt>
        <dd>A piece of software acting on behalf of an <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a> for
the purposes of utilizing Web Keys. Typically, this is blogging software, 
content distribution software, online merchant software or a Web-based
game.</dd>
        <dt><dfn title="key_listing_service" id="dfn-key_listing_service">key listing service</dfn></dt>
        <dd>A Web service that is responsible for registering and publishing
Web keys for an <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a></dd>
        <dt><dfn title="configuration_service" id="dfn-configuration_service">configuration service</dfn></dt>
        <dd>A Web service that is used to publish the public Web service
end-points and other public configuration information for a
<a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>. A <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="must">must</em>
publish this service at a top-level IRI named 
<code>/.well-known/linked-data-services</code>. The document <em class="rfc2119" title="must">must</em> be available 
in JSON-LD compacted form and <em class="rfc2119" title="must">must</em> include the 
<code>http://purl.org/web-keys/v1</code> JSON-LD context. The following
key <em class="rfc2119" title="must">must</em> be present in the published document:
<code>wkey:publicKeyService</code>.</dd>
        <dt><dfn title="public_key_registration_service" id="dfn-public_key_registration_service">public key registration service</dfn></dt>
        <dd>An interactive Web service used to register PEM-encoded 
X.509 public keys with the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>.</dd>
        </dl>
        <p></p>
      </div>

      <div id="key-owner-registration" class="section">
        <h3><span class="secno">2.2 </span>Key Owner Registration</h3>
        <p>
In order for an <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a> to register a key, they must have an
<a class="tref internalDFN" title="account" href="#dfn-account">account</a> on a <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>. How this 
<a class="tref internalDFN" title="account" href="#dfn-account">account</a> is created is outside of the scope of this 
specification. However, the end result of this sign up process <em class="rfc2119" title="must">must</em> result in 
an <a class="tref internalDFN" title="account" href="#dfn-account">account</a> being created for the <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a>:
        </p>
      </div>

      <div id="web-key-registration" class="section">
        <h3><span class="secno">2.3 </span>Web Key Registration</h3>
        <p>
In order for an <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a> to take part in the 
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> infrastructure, they <em class="rfc2119" title="must">must</em> register their 
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> with a <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>.
        </p>
The registration process is typically performed by a
<a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a>. The registration is accomplished by executing
the following algorithm:
        <ol class="algorithm">
          <li>
The <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> generates and stores a public/private key-pair 
that will be used by the <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> to digitally sign and/or
encrypt messages.</li>
          <li>The <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> retrieves the 
<a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> configuration from the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI.
            <ol class="algorithm">
              <li>The <a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI is generated 
by concatenating a base IRI for the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>, 
such as <code>https://example.com/</code> with the 
<code>/.well-known/linked-data-services</code> suffix. 
For example, the previous <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> IRI concatenated 
with the configuration suffix would result in the following 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a>
IRI: <code>https://example.com/.well-known/linked-data-services</code>.</li>
              <li>An HTTPS GET is performed on the 
<a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> IRI with the HTTP <code>Accept</code> header 
set to <code>application/ld+json; form=compacted</code>. The
<a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="must">must</em> respond with a compacted JSON-LD document
using the context specified at <code>http://purl.org/web-key/v1</code>.</li>
              <li>The result <em class="rfc2119" title="must">must</em> be a JSON-LD document containing a flat set of
key-value pairs. The data <em class="rfc2119" title="must">must</em> contain at least the properties defined in 
the <a class="tref internalDFN" title="configuration_service" href="#dfn-configuration_service">configuration service</a> section.
              </li>
            </ol>
          </li>
          <li>
The <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> initiates an HTTP 302 redirect
for the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>. An HTTPS GET request is performed
to the <a class="tref internalDFN" title="public_key_registration_service" href="#dfn-public_key_registration_service">public key registration service</a> IRI with the addition of 
two IRI query parameters. The first parameter, <code>public-key</code>, is the 
URL-encoded X.509 PEM-encoded public key. The second parameter, 
<code>registration-callback</code>,
is the URL-encoded <a class="tref" title="registration_callback_service">registration callback service</a> 
IRI for the <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a>.</li>
          <li>
The <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> associates the 
<a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> with the <a class="tref" title="key_listing_account">key listing account</a> based on the
provided public key. Note that this process <em class="rfc2119" title="must">must</em> authenticate the 
<a class="tref" title="key_listing_account">key listing account</a> via a login process if the 
<a class="tref" title="key_listing_account">key listing account</a> does not have an active login session. Other
configuration steps may be performed at this stage, including the 
specification of defaults for the particular <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a>.</li>
          <li>
The <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> specifies a set of 
<a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> configuration values and encrypts the 
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> according to the steps outlined in
the <a href="#response-encryption-algorithm">Response Encryption Algorithm</a>
section. The result is sent 
back to the <code>registration-callback</code> IRI via a POST 
initiated by the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>.
            <ol class="algorithm">
              <li>The following configuration value <em class="rfc2119" title="must">must</em> be included in the
JSON-LD response to the <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a>: <code>sec:publicKey</code>.
              </li>
              <li>The JSON-LD response is compacted and encrypted using the
public key associated with the registration request according to the
algorithm defined in
<a href="#response-encryption-algorithm">Response Encryption Algorithm</a>.
              </li>
              <li>The <a class="tref" title="encrypted_response">encrypted response</a> is transmitted to the
<code>registration-callback</code> via an HTTP POST request that is initiatited
by the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>. This is most commonly accomplished by having
the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> generate an HTML form that can be submitted
to the <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> when a form submission button is clicked
via the <a class="tref internalDFN" title="user_agent" href="#dfn-user_agent">user agent</a>.
              </li><li>The <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> decrypts the base-64
encoded byte stream, extracts the configuration values and stores the
location of the <code>sec:publicKey</code> for use when messages are being
digitally signed or encrypted.</li>
            </ol>
          </li>
        </ol>
        <p></p>

        <p>
The example below shows the full protocol-level exchange between the
<a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> and the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a>. For
the sake of brevity, not every optional parameter is included, just the bare
minimum necessary to perform the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> registration.
        </p>

<pre class="example">
--------------------------------- Step #1 -----------------------------------

*** Request: user agent -&gt; key agent

POST /register-key HTTP/1.1
Host: my-host.example.org
Content-Length: 47
Content-Type: application/x-www-form-urlencoded

key-listing-service=http%3A%2F%2Fkeys-r-us.example.com%2F

*** key agent generates and stores public/private keypair

-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il
0LXJrhUY43V/lLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2
B5u4m0LtXyaFWtbQV9+hY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B
US89y0M909ZTj2zDQwIDAQAB
-----END PUBLIC KEY-----

-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQDptIkqrXhx7YVGsBZ5fY/Lz0il0LXJrhUY43V/lLWdRf7JXY6t
cgA5AmwNGZtJRyH79QXCJn+BAHUtl6gX2gvjs8N2B5u4m0LtXyaFWtbQV9+hY3JR
LOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0BUS89y0M909ZTj2zDQwIDAQAB
AoGALNmBrVgHEk4T0qH+XihTjThlZ7Tq/h5TXChipy5BwEHriHdU50JGeqpVVBpC
68gj5Hd8OGss8vPEiRBeqN0mhJlRaX5ijyFp2n8+7DhfOIVhCd1MXCGQPTrdXIo5
OOQECSplnALZfKr0VC4TBeW+oUZGMoG4rRSM5DfyPFJtlzECQQD8DkWBkhRsP1An
3qfZR8oUkvbaVg9jsCNvoBazYSS3OhsZ96ZSTyf9hJn28wGJmShuZA2eL5XjuTY4
m0fQDhj5AkEA7VzAqKOx5zlFTWXMIzn29uB59m4yJ7UwCyc7tisQA16I8B2HzJzZ
saipkpU2RUYaBrjtWaiVNtyXvZ7mccJpGwJBAMyE4/8bwfiHcwm2z+ktKBqDmUtW
E0ynKkmz01ef1kPaIQ1z9f/JfMBnrOpFCZVVsgnIo4gcQnox2X4a+S0nkzkCQBre
xCSTG2Gclx7S5lAakL2T3dqq0Nyz4zNwBo9xwodPHVtpTGU6YF5/RGsGnzUqYWnf
Z2cd8X5bbIYXxeic5H8CQQCcBOtOdrq9FXsEnyhG5gQXvGdxEAmM2eUs1g8E8kgx
KBTHOaBRQMgvjsdA/obrs7D0HrEbQqGOy7JBYGWZTsiI
-----END RSA PRIVATE KEY-----

--------------------------------- Step #2 -----------------------------------

*** Request: key agent -&gt; key listing service

GET /.well-known/linked-data-services HTTP/1.1
Host: keys-r-us.example.com
Accept: application/ld+json,*/*;q=0.1

*** Response: key agent &lt;- key listing service

HTTP/1.1 200 OK
Connection: close
Content-Length: 6075
Content-Type: application/ld+json
Date: Wed, 21 Sep 2012 22:30:16 GMT
Host: keys-r-us.example.com
Server: Apache/2.2.19 (Debian)

{
   "@context": "http://purl.org/web-key/v1",
   "@id": "http://keys-r-us.example.com/i/key-master",
   "wkey:publicKeyService": "http://keys-r-us.example.com/keys",
}

--------------------------------- Step #3 -----------------------------------

*** Redirect: user agent &lt;- key agent

HTTP/1.1 303 See Other
Location: https://keys-r-us.example.com/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fmy-host.example.org%2Fregistration-complete?nonce=pn9sueh43jefa
Content-Type: text/html
Content-Length: 174

&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Identity Registration&lt;/title&gt;
 &lt;/head&gt;
 &lt;body&gt;
  &lt;h1&gt;Public Key Registration&lt;/h1&gt;
   &lt;p&gt;You must now go to your authority and 
    &lt;a href="http://keys-r-us.example.com/keys?public-key=↩
-----BEGIN+PUBLIC+KEY-----%0A↩
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDptIkqrXhx7YVGsBZ5fY%2FLz0il%0A↩
0LXJrhUY43V%2FlLWdRf7JXY6tcgA5AmwNGZtJRyH79QXCJn%2BBAHUtl6gX2gvjs8N2%0A↩
B5u4m0LtXyaFWtbQV9%2BhY3JRLOBiydPeXLgsnLwKiJ9v4CNXSNA5wT8vYGXiqq0B%0A↩
US89y0M909ZTj2zDQwIDAQAB%0A↩
-----END+PUBLIC+KEY-----↩
&amp;registration-callback=http%3A%2F%2Fmy-host.example.org%2Fregistration-complete?nonce=pn9sueh43jefa"&gt;
    register your identification information&lt;/a&gt; 
    there.&lt;/p&gt;
 &lt;/body&gt;
&lt;/html&gt;

--------------------------------- Step #4 -----------------------------------

*** This step consists of a series of UI interactions and is thus not
*** specified in this specification.

--------------------------------- Step #5 -----------------------------------

*** The key listing service creates a configuration object to return back
*** to the publishing agent

{
   "sec:publicKey": "http://keys-r-us.example.com/keys/8472",
}

*** The configuration object is then encrypted and sent to the 
*** registration-callback specified in the registration request above.

POST registration-complete?nonce=pn9sueh43jefa HTTP/1.1
Host: my-host.example.org
Content-Length: 473
Content-Type: application/ld+json

{
   "@type": "sec:EncryptedMessage",
   "sec:data": "VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==",
   "sec:encryptionKey": "uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=",
   "sec:cipher": "aes-128-cbc",
   "sec:iv": "vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==",
   "sec:publicKey": "http://keys-r-us.example.com/keys/8472"
}</pre>
      </div>

      <div id="security-concerns-for-registration" class="section">
        <h3><span class="secno">2.4 </span>Security Concerns for Registration</h3>

        <ul>
          <li>
All requests to the <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="must">must</em> be made using HTTPS
to ensure configuration data is not tampered with in transit.
          </li>
          <li>
The registration request from the <a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> to the
<a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="must">must</em> contain a <a class="tref" title="nonce">nonce</a> value
for the <code>registration-callback</code> IRI to protect the 
<a class="tref internalDFN" title="key_agent" href="#dfn-key_agent">key agent</a> against 
<a href="http://en.wikipedia.org/wiki/Replay_attack">replay attacks</a>.
          </li>
        </ul>

      </div>
    </div>

    <div id="discovery" class="section">
      
<!-- OddPage -->
<h2><span class="secno">3. </span>Discovery</h2>
      <p class="issue">
Write section about how a <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="must">must</em> make the
key IRI returned to the registrant a machine-readable document, either via
JSON-LD or RDFa. This means that machines can de-reference the public key
IRI and discover other information about the key such as the owner, expiration
date/time, etc.
      </p>
    </div>

    <div id="messaging" class="section">
      
<!-- OddPage -->
<h2><span class="secno">4. </span>Messaging</h2>
      <p class="issue">
Need to write an introduction to verifiable messaging and why it's important.
      </p>

      <div id="messaging-terms" class="section">
        <h3><span class="secno">4.1 </span>Messaging Terms</h3>
        <p>
The following terminology is used to describe concepts used to generate and 
secure messages that are sent and received using Web Keys. Many of these 
terms are borrowed from public/private key cryptography. A more complete 
description of public/private cryptography can be found in 
The Advanced Encryption Standard [<cite><a class="bibref" rel="biblioentry" href="#bib-AES">AES</a></cite>].
        </p>
        
        <dl>
          <dt><dfn title="message" id="dfn-message">message</dfn></dt>
          <dd>
A JSON-LD byte stream that is used to convey a request or a response in the 
system.
          </dd>
          <dt><dfn title="public_key" id="dfn-public_key">public key</dfn></dt>
          <dd>
A cryptographic mechanism that can be used to verify digital signatures or
encrypt small messages such that only the software with access to the
corresponding <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> can decrypt the small message.
          </dd>
          <dt><dfn title="private_key" id="dfn-private_key">private key</dfn></dt>
          <dd>
A cryptographic mechanism that can be used to generate digital signatures and
decrypt encrypted data.
          </dd>
          <dt><dfn title="signed_message" id="dfn-signed_message">signed message</dfn></dt>
          <dd>
A type of message that has a digital signature attached to it, generated using
a <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>, that is verifiable and incredibly difficult to
forge.
          </dd>
          <dt><dfn title="intermediate_value" id="dfn-intermediate_value">intermediate value</dfn></dt>
          <dd>
A cryptographic input to an encryption algorithm. This is typically a 16-byte
value in AES.
          </dd>
          <dt><dfn title="encrypted_message" id="dfn-encrypted_message">encrypted message</dfn></dt>
          <dd>
A type of message that has been obfuscated using a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>,
which is incredibly difficult to decode by any person except for the one
that holds the associated <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>.
          </dd>
        </dl>
        
      </div>

      <div id="message-signature-algorithm" class="section">
        <h3><span class="secno">4.2 </span>Message Signature Algorithm</h3>
        <p>
The following algorithm ensures that the originator of an Web service call 
can be verified as long as the public key can be retrieved by the receiver. A
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> is provided as input and, using a
<a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> and a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI, a
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Remove any <code>sec:signature</code> key-value pair from the top-level of the
<a class="tref internalDFN" title="message" href="#dfn-message">message</a>. Copy the <a class="tref internalDFN" title="message" href="#dfn-message">message</a> to the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>.
          </li>
          <li>
Generate the <dfn title="normalized_message" id="dfn-normalized_message">normalized message</dfn> by normalizing the 
<a class="tref internalDFN" title="message" href="#dfn-message">message</a> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
          </li>
          <li>
Generate the <dfn title="signature_value" id="dfn-signature_value">signature value</dfn> by:
            <ol class="algorithm">
              <li>
Create a <dfn title="timestamped_message" id="dfn-timestamped_message">timestamped message</dfn> and initialize it to the
emtpy string. Generate an  ISO8601 <dfn title="combined_date_and_time_string" id="dfn-combined_date_and_time_string">combined date and time string</dfn> 
containing the current date and time, accurate to at least one second, in 
Universal Time Code format. For example: <code>2011-09-23T20:21:34Z</code>. 
Append the <a class="tref internalDFN" title="combined_date_and_time_string" href="#dfn-combined_date_and_time_string">combined date and time string</a> to the 
<a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a>. Append the <a class="tref internalDFN" title="normalized_message" href="#dfn-normalized_message">normalized message</a> 
to the <a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a>.
              </li>
              <li>
Digitally sign the <a class="tref internalDFN" title="timestamped_message" href="#dfn-timestamped_message">timestamped message</a> using the 
<a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a> and then base-64 encode the resulting value. The 
resulting base-64 encoded string is the <a class="tref internalDFN" title="signature_value" href="#dfn-signature_value">signature value</a>.
              </li>
            </ol>
          </li><li>
Add a <code>sec:signature</code> key to the <a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> with
a JSON object containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code></dt><dt>
              </dt><dd><code>sec:JsonLdSignature</code></dd>
              <dt><code>dc:created</code></dt><dt>
              </dt><dd>
The string value of the <a class="tref internalDFN" title="combined_date_and_time_string" href="#dfn-combined_date_and_time_string">combined date and time string</a> generated
by this algorithm.
              </dd>
              <dt><code>sec:responseToken</code></dt><dt>
              </dt><dd>
A string value that will be encoded in the encrypted response to the requesting
agent. It is <em class="rfc2119" title="recommended">recommended</em> that this value is a session identifier that is 
associated with the user agent that initiated the request, plus a hyphen, 
plus a cryptographically secure random string used as a one-time pad. 
For example, <code>jf793ksj72jkf-78p82qpj87dnd2f839</code>. See 
<a href="#the-response-token">The Response Token</a> section to understand 
more about how this value is used to prevent replay attacks and its accepted
limitations.
              </dd>
              <dt><code>sec:publicKey</code></dt><dt>
              </dt><dd>The value of the input <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI.</dd>
              <dt><code>sec:signatureValue</code></dt><dt>
              </dt><dd>
The value of the <a class="tref internalDFN" title="signature_value" href="#dfn-signature_value">signature value</a> generated by this algorithm.
              </dd>
            </dl>
          </li>
        </ol>

        <p>
The following example shows an input <a class="tref internalDFN" title="message" href="#dfn-message">message</a> and the resulting
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>:
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">*** message
{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">Hello World!</span><span class="pln">"
}

*** signed message
{
   "</span><span class="kwd">@context</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/v1</span><span class="pln">",
   "</span><span class="atn jsonld-curie">dc:title</span><span class="pln">": "</span><span class="str">Hello World!</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:signature</span><span class="pln">":
   {
      "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">sec:JsonLdSignature</span><span class="pln">",
      "</span><span class="atn jsonld-curie">dc:created</span><span class="pln">": "</span><span class="tag jsonld-curie">2011-09-23T20:21:34Z</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signer</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/john/keys/5</span><span class="pln">",
      "</span><span class="atn jsonld-curie">sec:signatureValue</span><span class="pln">": "</span><span class="str">OGQzNGVkMzVm4NTIyZTkZDYMmMzQzNmExMgoYzI43Q3ODIyOWM32NjI=</span><span class="pln">"
   }
}
        </span></pre>

      </div>

      <div id="message-signature-verification-algorithm" class="section">
        <h3><span class="secno">4.3 </span>Message Signature Verification Algorithm</h3>
        <p>
In order to ensure a secure communication environment the following algorithm
<em class="rfc2119" title="should">should</em> be used to verify all request signatures in the system. A
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> is provided as input and an indication of whether
the signature is valid or a forgery is produced as output.
        </p>
        
        <ol class="algorithm">
          <li>
Generate the <dfn title="original_message" id="dfn-original_message">original message</dfn> by copying the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a> and removing the <code>sec:signature</code> value
from the <a class="tref internalDFN" title="original_message" href="#dfn-original_message">original message</a>.
          </li>
          <li>
Generate the <dfn title="original_normalized_message" id="dfn-original_normalized_message">original normalized message</dfn> by normalizing the 
<a class="tref internalDFN" title="original_message" href="#dfn-original_message">original message</a> according to the 
<a href="http://json-ld.org/spec/ED/20110911#normalization-1">JSON-LD 
Universal Graph Normalization Algorithm (UGNA2011)</a>.
          </li>
          <li>
Verify the <dfn title="original_signature_value" id="dfn-original_signature_value">original signature value</dfn>:
            <ol class="algorithm">
              <li>
Generate the <dfn title="original_timestamped_message" id="dfn-original_timestamped_message">original timestamped message</dfn> by setting its value to 
the value of the <code>dc:created</code> key in the 
<a class="tref internalDFN" title="signed_message" href="#dfn-signed_message">signed message</a>. Append the
<a class="tref internalDFN" title="original_normalized_message" href="#dfn-original_normalized_message">original normalized message</a> to the 
<a class="tref internalDFN" title="original_timestamped_message" href="#dfn-original_timestamped_message">original timestamped message</a>.
              </li>
              <li>
Retrieve the PEM-encoded <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> from the
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI provided in
<code>sec:signer</code> value. The <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> <em class="rfc2119" title="may">may</em> also be retrieved
from a cache. ???Verify the <a class="tref" title="original_nonced_message">original nonced message</a>
using the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>??? 
<div class="note">We need to be more explicit about what is happening here.</div>
              </li>
            </ol>
        </li></ol>
      </div>

      <div id="message-encryption-algorithm" class="section">
        <h3><span class="secno">4.4 </span>Message Encryption Algorithm</h3>
        <p>
The following algorithm ensures that a message intended for a particular
recipient can be obfuscated such that only the intended recipient can read the
message. A <a class="tref internalDFN" title="message" href="#dfn-message">message</a> is provided as input and, using a
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> and a <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI, a 
<a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> is produced as output.
        </p>

        <ol class="algorithm">
          <li>
Generate a 
<a href="http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">cryptographically secure</a> 
<dfn title="symmetric_key" id="dfn-symmetric_key">symmetric key</dfn> that is exactly 16 bytes in length.
          </li>
          <li>
Generate a 
<a href="http://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator">cryptographically secure</a>
<a class="tref" title="initialization_vector">initialization vector</a> that is exactly 16 bytes in length.
          </li>
          <li>
Generate the <dfn title="encrypted_initialization_vector" id="dfn-encrypted_initialization_vector">encrypted initialization vector</dfn> by using the
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> to encrypt the <a class="tref" title="initialization_vector">initialization vector</a>.
          </li>
          <li>
Generate the <dfn title="encrypted_data" id="dfn-encrypted_data">encrypted data</dfn> by encrypting the <a class="tref internalDFN" title="message" href="#dfn-message">message</a>
using the RSA with AES 128-bit Cyclic Block Chaining algorithm, using the
<a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a> and the <a class="tref" title="initialization_vector">initialization vector</a>
generated previously in this algorithm.
          </li>
          <li>
Generate the <dfn title="encrypted_symmetric_key" id="dfn-encrypted_symmetric_key">encrypted symmetric key</dfn> by using the 
<a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> to encrypt the <a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a>.
          </li>
Generate the <a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> by creating a JSON object
containing the following key-value pairs:
            <dl style="margin-left: 1em;">
              <dt><code>@type</code></dt><dt>
              </dt><dd><code>sec:EncryptedMessage</code></dd>
              <dt><code>sec:data</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref internalDFN" title="encrypted_data" href="#dfn-encrypted_data">encrypted data</a>.
              </dd>
              <dt><code>sec:encryptionKey</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref" title="encrypted_key">encrypted key</a>.
              </dd>
              <dt><code>sec:cipher</code></dt><dt>
              </dt><dd>
The value <code>rsa-aes-128-cbc</code>.
              </dd>
              <dt><code>sec:iv</code></dt><dt>
              </dt><dd>
The base-64 encoded value of the <a class="tref internalDFN" title="encrypted_initialization_vector" href="#dfn-encrypted_initialization_vector">encrypted initialization vector</a>.
              </dd>
              <dt><code>sec:publicKey</code></dt><dt>
              </dt><dd>
The <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a>
that was used to encrypt the <a class="tref internalDFN" title="symmetric_key" href="#dfn-symmetric_key">symmetric key</a> in this
algorithm.
              </dd>
            </dl>
          
        </ol>

        <p>
The following example shows a typical input message and what an encrypted
message looks like when generated using the algorithm above.
        </p>

        <pre class="example prettyprint language-jsonld">
<span class="pln">*** message
{
   "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">ps:Preferences</span><span class="pln">"
   "</span><span class="atn jsonld-curie">com:currency</span><span class="pln">": "</span><span class="str">USD</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:minimumAmount</span><span class="pln">": "</span><span class="str">0.05</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:maximumRate</span><span class="pln">": "</span><span class="str">10.0</span><span class="pln">",
   "</span><span class="atn jsonld-curie">com:destination</span><span class="pln">": "</span><span class="tag jsonld-uri">https://example.com/people/manu/accounts/article-sales</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:publicKey</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/manu/keys/23</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:license</span><span class="pln">": "</span><span class="tag jsonld-uri">http://purl.org/payswarm/licenses/blogging</span><span class="pln">",
   "</span><span class="atn jsonld-curie">ps:licenseHash</span><span class="pln">": "</span><span class="str">961ec496092bf6ee08d6255d96069b5186332689</span><span class="pln">",
}

*** encrypted message
{
   "</span><span class="kwd">@type</span><span class="pln">": "</span><span class="tag jsonld-curie">sec:EncryptedMessage</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:data</span><span class="pln">": "</span><span class="str">VTJGc2RHVmtYMThOY3h2dnNVN290Zks1dmxWc3labi9sYkU0TGloRTdxY0dpblE4OHgrUXFNNi9l\n↩
a1JMWjdXOApRSGtrbzh6UG5XOFo3WWI4djJBUG1abnlRNW5CVGViWkRGdklpMEliczNWSzRQTGdB\n↩
UFhxYTR2aWFtemwrWGV3Cmw0eFF4ancvOW85dTlEckNURjMrMDBKMVFubGdtci9abkFRSmc5UjdV\n↩
Rk55ckpYalIxZUJuKytaQ0luUTF2cUwKcm5vcDU1eWk3RFVqVnMrRXZZSkx6RVF1VlBVQ0xxdXR4\n↩
L3lvTWd4bkdhSksxOG5ZakdiekJxSGxOYm9pVStUNwpwOTJ1Q0Y0Q2RiR1NqL0U3OUp4Vmh6OXQr\n↩
Mjc2a1V3RUlNY3o2Z3FadXZMU004KzRtWkZiakh6K2N5a1VVQ2xHCi9RcTk3b2o3N2UrYXlhZjhS\n↩
ZmtEZzlUeWk3Q2szREhSblprcy9WWDJWUGhUOEJ5c3RiYndnMnN4eWc5TXhkbHoKUkVESzFvR0FJ\n↩
UDZVQ09NeWJLTGpBUm0zMTRmcWtXSFdDY29mWFNzSGNPRmM2cnp1Wko0RnVWTFNQMGROUkFRRgpB\n↩
bFQ0QUpPbzRBZHpIb2hpTy8vVGhNOTl1U1ZER1NPQ3graFAvY3V4dGNGUFBSRzNrZS8vUk1MVFZO\n↩
YVBlaUp2Ckg4L1ZWUVU4L3dLZUEyeTQ1TzQ2K2lYTnZsOGErbGg0NjRUS3RabktFb009Cg==</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:encryptionKey</span><span class="pln">": "</span><span class="str">uATtey0c4nvZIsDIfpFffuCyMYGPKRLIVJCsvedE013SpEJ+1uO7x6SK9hIG9zLWRlPpwmbar2bt\n↩
gTX5NBzYC5+c5ZkXtM1O8REwIJ7wmtLdumRYEbr/TghFl3pAgXhv0mVt8XZ+KLWlxMqXnrT+ByNw\n↩
z7u3IxpqNVcXHExjXQE=</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:cipher</span><span class="pln">": "</span><span class="str">rsa-aes-128-cbc</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:iv</span><span class="pln">": "</span><span class="str">vcDU1eWTy8vVGhNOszREhSblFVqVnGpBUm0zMTRmcWtMrRX==</span><span class="pln">",
   "</span><span class="atn jsonld-curie">sec:publicKey</span><span class="pln">": "</span><span class="tag jsonld-uri">http://payswarm.example.com/i/manu/keys/23</span><span class="pln">"
}
        </span></pre>
        
      </div>
      
      <div id="message-decryption-algorithm" class="section">
        <h3><span class="secno">4.5 </span>Message Decryption Algorithm</h3>
        <p>
The following algorithm is used to decrypt an encrypted response. The input
is an <a class="tref internalDFN" title="encrypted_message" href="#dfn-encrypted_message">encrypted message</a> and the result is the 
<dfn title="original_unencrypted_message" id="dfn-original_unencrypted_message">original unencrypted message</dfn>.
        </p>
        
        <ol class="algorithm">
          <li>
Generate the <dfn title="decryption_key" id="dfn-decryption_key">decryption key</dfn> by base-64 decoding the
<code>sec:encryptionKey</code> value and using the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>
associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI in
<code>sec:publicKey</code> to decrypt the base-64 decoded value.
<div class="issue">Refer to the exact algorithm that is used to do the
decryption in the AES spec.</div>
          </li>
          <li>
Generate the <a class="tref internalDFN" title="intermediate_value" href="#dfn-intermediate_value">intermediate value</a> by base-64 decoding the
<code>sec:iv</code> value and then using the <a class="tref internalDFN" title="private_key" href="#dfn-private_key">private key</a>
associated with the <a class="tref internalDFN" title="public_key" href="#dfn-public_key">public key</a> IRI in
<code>sec:publicKey</code> to decrypt the base-64 decoded value.
          </li>          
          <li>
Generate the <dfn title="original_unencrypted_message" id="dfn-original_unencrypted_message-1">original unencrypted message</dfn> by applying the
<code>sec:cipher</code> to the <code>sec:data</code> value. Use the
<a class="tref internalDFN" title="decryption_key" href="#dfn-decryption_key">decryption key</a> and <a class="tref internalDFN" title="intermediate_value" href="#dfn-intermediate_value">intermediate value</a> generated in
this algorithm as inputs to the cipher algorithm.
          </li>
        </ol>
      </div>

      <div id="security-considerations" class="section">
        <h3><span class="secno">4.6 </span>Security Considerations</h3>
        <p>
Since this specificationd describes a financial system, the security of the
communication in the system is of utmost importance. The following section
describes security considerations that developers implementing this 
specification should be aware of in order to create secure software.
        </p>

        <div id="the-response-token" class="section">
        <h4><span class="secno">4.6.1 </span>The Response Token</h4>        
          <p>
The <code>sec:responseToken</code> mechanism is used in order to prevent
replay attacks, but implementers must be aware that it is not capable of 
preventing man-in-the-middle attacks. Only a full end-to-end encryption channel
is capable of accomplishing that feat and if implementers are concerned about
man-in-the-middle attacks, they are strongly advised to run all callbacks
over HTTPS.
          </p>
          <p>
While implementation of the response 
token to prevent replay attacks is left as an exercise to the developer, it
is advised that it is treated as a one-time token. That is, when a response
token is sent from one peer to another peer, the sender must note the
response token in an internal database. When the response token is returned in
an encrypted message, the response token must be deleted from the internal
database so all successive calls using the same response token will fail.
This simple behavior prevents replay attacks and is simpler to implement than
a security nonce.
          </p>
          <p>
To further increase security, it is advised that the response token is tied to
the originating client's IP address in some way. The resulting response callback
should be executed by the same client's IP address, thus many classes of 
man-in-the-middle attacks can be prevented, requiring quite a sophisticated 
attack in order to hijack the response. Note that the hijacker will not be able 
to modify the response, but merely callback-jack the response. The result of
the callback-jack would be fairly benign in most cases - gaining access
to an article that was purchased by the original user agent that initiated
the request. The original purchaser will still have access
to the article, so the only damage done is the ability to view or download an
article as someone else. If this is a concern to implementers, they are advised
to purchase a valid SSL certificate and ensure that all callbacks to their site
occur over SSL.
          </p>
        </div>
      
      </div>
      
    </div>

    <div id="permission-and-access-rights-delegation" class="section">
      
<!-- OddPage -->
<h2><span class="secno">5. </span>Permission and Access Rights Delegation</h2>
      <p>
During the <a href="#the-key-registration-process">Key Registration Process</a>,
a <a class="tref internalDFN" title="key_listing_service" href="#dfn-key_listing_service">key listing service</a> <em class="rfc2119" title="may">may</em> ask the <a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a> that is
registering to grant a number of permissions and access rights to any 
<a class="tref" title="agent">agent</a> that digitally signs a message to a Web service using the
registered key. Note that this mechanism is similar to the OAuth permission
granting mechanism and can be used in place of OAuth if the system requires
both Permission and Access Rights Delegation as well as digital signatures. To
take advantage of this mechanism, a <a class="tref" title="agent">agent</a> would digitally sign
a message requesting that a certain action be performed on behalf of the
<a class="tref internalDFN" title="actor" href="#dfn-actor">actor</a>.
      </p>
    </div>

    <div id="key-revocation-and-expiration" class="section">
      
<!-- OddPage -->
<h2><span class="secno">6. </span>Key Revocation and Expiration</h2>
      <p>
In order for a <a class="tref" title="key_pair">key pair</a> to be revoked, the 
<code>sec:revocationDate</code> <em class="rfc2119" title="must">must</em> be associated with the key. In order to
specify an expiration date for a <a class="tref" title="key_pair">key pair</a>, the 
<code>sec:expirationDate</code> <em class="rfc2119" title="must">must</em> be associated with the key.
All software systems utilizing the <a class="tref" title="key_pair">key pair</a> <em class="rfc2119" title="must">must</em> honor the 
revocation and expiration dates and fail to verify any signatures made on 
or after the date and time specified. Similarly, the 
<code>dc:created</code> date establishes the date and time on which the
key can be used to digitally sign and encrypt data.
All software systems utilizing the <a class="tref" title="key_pair">key pair</a> <em class="rfc2119" title="must">must</em> honor the 
creation date and fail to verify any signatures made before the date and 
time specified.
      </p>
    </div>

   


<div id="references" class="appendix section">
<!-- OddPage -->
<h2><span class="secno">A. </span>References</h2><div id="normative-references" class="section"><h3><span class="secno">A.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-AES">[AES]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf"><cite>NIST FIPS 197: Advanced Encryption Standard (AES)</cite></a>. November 2001. URL: <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf</a>
</dd><dt id="bib-JSON-LD">[JSON-LD]</dt><dd>Manu Sporny; Gregg Kellogg; Dave Longley; et al. <a href="http://json-ld.org/spec/latest/"><cite>JSON-LD</cite></a> latest. W3C Community Group Working Draft. URL: <a href="http://json-ld.org/spec/latest/">http://json-ld.org/spec/latest/</a> 
</dd></dl></div><div id="informative-references" class="section"><h3><span class="secno">A.2 </span>Informative references</h3><p>No informative references.</p></div></div></body></html>
